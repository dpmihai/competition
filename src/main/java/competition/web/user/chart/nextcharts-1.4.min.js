function hsvToRgb(j,u,n){var a,k,m;var e;var l,d,c,o;j=Math.max(0,Math.min(360,j));u=Math.max(0,Math.min(100,u));n=Math.max(0,Math.min(100,n));u/=100;n/=100;if(u==0){a=k=m=n;return[Math.round(a*255),Math.round(k*255),Math.round(m*255)]}j/=60;e=Math.floor(j);l=j-e;d=n*(1-u);c=n*(1-u*l);o=n*(1-u*(1-l));switch(e){case 0:a=n;k=o;m=d;break;case 1:a=c;k=n;m=d;break;case 2:a=d;k=n;m=o;break;case 3:a=d;k=c;m=n;break;case 4:a=o;k=d;m=n;break;default:a=n;k=d;m=c}return[Math.round(a*255),Math.round(k*255),Math.round(m*255)]}function hsvToHex(d,c,a){var b=hsvToRgb(d,c,a);return rgbToHex(b[0],b[1],b[2])}function distinctHexColors(c){var a=[];for(var b=0;b<360;b+=360/c){a.push(hsvToHex(b,100,100))}return a}function colorLuminance(b,a){var f=colorToHex(b);f=String(f).replace(/[^0-9a-f]/gi,"");if(f.length<6){f=f[0]+f[0]+f[1]+f[1]+f[2]+f[2]}a=a||0;var d="#",g,e;for(e=0;e<3;e++){g=parseInt(f.substr(e*2,2),16);g=Math.round(Math.min(Math.max(0,g+(g*a)),255)).toString(16);d+=("00"+g).substr(g.length)}return d}function componentToHex(b){var a=b.toString(16);return a.length==1?"0"+a:a}function rgbToHex(d,c,a){return"#"+componentToHex(d)+componentToHex(c)+componentToHex(a)}function colorToHex(b){var a=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/.exec(b);return a?"#"+(1<<24|a[1]<<16|a[2]<<8|a[3]).toString(16).substr(1):b}function isCanvasEnabled(){return !!document.createElement("canvas").getContext}function getParentWidth(a){return document.getElementById(a).parentNode.offsetWidth}function getWidth(a){return a.offsetWidth}function niceNum(b,a){var e;var d;var c;e=Math.floor(getBaseLog(10,b));d=b/Math.pow(10,e);if(a){if(d<1.5){c=1}else{if(d<3){c=2}else{if(d<7){c=5}else{c=10}}}}else{if(d<=1){c=1}else{if(d<=2){c=2}else{if(d<=5){c=5}else{c=10}}}}return c*Math.pow(10,e)}function getBaseLog(a,b){return Math.log(b)/Math.log(a)}function calculateYStep(e,a,b){if(e==a){a=e+1}var c=niceNum(a-e,false);var g=niceNum(c/(b-1),true);var d=Math.floor(e/g)*g;var f=Math.ceil(a/g)*g;if((d==e)&&(d!=0)){d=d-g}return{minValY:d,maxValY:f,yStep:(f-d)/b}}function getMousePos(d,b){var a=$(window);var f=$(d).parent();var e,c;if(f.is("body")){e=b.clientX-d.offsetLeft+a.scrollLeft();c=b.clientY-d.offsetTop+a.scrollTop()}else{e=b.clientX-f.offset().left+a.scrollLeft();c=b.clientY-f.offset().top+a.scrollTop()}return{x:e,y:c}}function posTop(){return typeof window.pageYOffset!="undefined"?window.pageYOffset:document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function posLeft(){return typeof window.pageYOffset!="undefined"?window.pageYOffset:document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}var handleMouseEvent={execute:function(a,d,n){var c=d.getContext("2d");d.style.left=(a.offsetLeft+this.mousePos.x)+"px";c.clearRect(0,0,d.width,d.height);var j=c.measureText(this.tooltip).width;var l=d.width/2-j/2;var k=40;var o=this.tooltip.split("<br>");if(o.length==1){d.width=j+20;d.height=25;l=d.width/2-j/2;c.fillText(this.tooltip,l,15)}else{var m=(o.length-1)*12;d.height=25+m;k+=m;var g=0;for(var e=0;e<o.length;e++){var h=c.measureText(o[e]).width;if(h>g){g=h}}if(d.width<=g){d.width=g+20}l=d.width/2-g/2;for(var e=0;e<o.length;e++){c.fillText(o[e],l,15+e*12)}}var b=d.offsetLeft+d.width;var f=a.offsetLeft+a.width;if(b>f){d.style.left=d.offsetLeft-(b-f)+"px"}d.style.top=(a.offsetTop+this.mousePos.y-k)+"px";if(this.tooltip==""){d.style.left="-2000px"}}};function drawEllipseByCenter(c,a,e,b,d){drawEllipse(c,a-b/2,e-d/2,b,d)}function drawUpperEllipseByCenter(c,a,e,b,d){drawUpperEllipse(c,a-b/2,e-d/2,b,d)}function drawEllipse(n,k,j,l,d){var g=0.5522848,c=(l/2)*g,a=(d/2)*g,m=k+l,f=j+d,e=k+l/2,b=j+d/2;n.moveTo(k,b);n.bezierCurveTo(k,b-a,e-c,j,e,j);n.bezierCurveTo(e+c,j,m,b-a,m,b);n.bezierCurveTo(m,b+a,e+c,f,e,f);n.bezierCurveTo(e-c,f,k,b+a,k,b)}function drawUpperEllipse(n,k,j,l,d){var g=0.5522848,c=(l/2)*g,a=(d/2)*g,m=k+l,f=j+d,e=k+l/2,b=j+d/2;n.moveTo(k,b);n.bezierCurveTo(k,b-a,e-c,j,e,j);n.bezierCurveTo(e+c,j,m,b-a,m,b)}function findControlPoint(d,c,b){var m=b.x-d.x,u=b.y-d.y,h=Math.sqrt(m*m+u*u),r={x:m/h,y:u/h},l=c.x-d.x,t=c.y-d.y,g=Math.sqrt(l*l+t*t),q={x:l/g,y:t/g},p=r.x*q.x+r.y*q.y,s={x:d.x+r.x*p*g,y:d.y+r.y*p*g},e=c.x-s.x,j=c.y-s.y,a=Math.sqrt(e*e+j*j),y={x:e/a,y:j/a},o={x:(d.x+b.x)/2,y:(d.y+b.y)/2},n={x:c.x+y.x*a,y:c.y+y.y*a},w=s.x-o.x,v=s.y-o.y,f={x:n.x+w,y:n.y+v};return f}function drawCurve(a,e,d,b){var c=findControlPoint(e,d,b);a.moveTo(e.x,e.y);a.quadraticCurveTo(c.x,c.y,b.x,b.y)}function formatNumber(b,a,d,e){var c=b.toFixed(a);c=c.replace(".",d);return addThousandSeparator(c,d,e)}function addThousandSeparator(c,b,d){c+="";x=c.split(b);x1=x[0];x2=x.length>1?b+x[1]:"";var a=/(\d+)(\d{3})/;while(a.test(x1)){x1=x1.replace(a,"$1"+d+"$2")}return x1+x2}function getParameterValueFromURL(c,b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+b+"=([^&#]*)";var e=new RegExp(a);var d=e.exec(c);if(d==null){return""}else{return d[1]}}function isPercent(b){if(b===undefined){return false}var a=b.indexOf("%");if(a==b.length-1){return true}return false}function find(b,a){for(i=0;i<b.length;i++){if(b[i]==a){return i}}return false}var barChart=function(myjson,idCan,idTipCan,canWidth,canHeight){var obj;var data;var labels;var labelOrientation;var globalAlpha;var showGridX;var showGridY;var showLabels;var background;var message;var tickCount;var showTicks;var startingFromZero;var chartType;var chartStyle;var seriesColor;var xData,yData;var series;var yStep;var maxK=new Array();var minK=new Array();var maxSum=new Array();var dotsK=new Array();var max;var min;var tickStep;var minValY;var maxValY;var y2Step;var maxK2=new Array();var minK2=new Array();var max2;var min2;var minValY2;var maxValY2;var hStep2=0;var y2LegendSpace=0;var y2Count=1;var step=0;var gap=40;var hStep=60;var titleSpace=0;var legendSpace=0;var xLegendSpace=0;var yLegendSpace=0;var xaxisY=0;var cornerRadius=6;var realWidth;var realHeight;var canvas;var c;var tipCanvas;var H=cornerRadius;var tickInit;var resizeWidth=false;var resizeHeight=false;var adjustableTextFontSize=false;var maxLabelWidth=0;function drawBar(myjson,idCan,idTipCan,canWidth,canHeight){canvas=document.getElementById(idCan);if(canvas==null){return}tipCanvas=document.getElementById(idTipCan);c=canvas.getContext("2d");obj=myjson;chartType=obj.type;if(typeof chartType==="undefined"){chartType="bar"}if(isH(chartType)||(isStacked(chartType)&&(obj.lineData===undefined))){obj.dualYaxis=false}background=obj.background;if(typeof background==="undefined"){background="white"}chartStyle=obj.style;if((typeof chartStyle==="undefined")||(find(["normal","glass","cylinder","dome","parallelepiped"],chartStyle)===false)){chartStyle="normal"}data=obj.data[0];series=obj.data.length;labels=obj.labels;if(typeof labels==="undefined"){labels=[];for(var i=0;i<data.length;i++){labels.push("")}}labelOrientation=obj.labelOrientation;if(typeof labelOrientation==="undefined"){labelOrientation="horizontal"}globalAlpha=obj.alpha;if(typeof globalAlpha==="undefined"){globalAlpha=0.8}showTicks=obj.showTicks;if(typeof showTicks==="undefined"){showTicks=true}startingFromZero=obj.startingFromZero;if(typeof startingFromZero==="undefined"){startingFromZero=false}showGridX=obj.showGridX;if(typeof showGridX==="undefined"){showGridX=true}showGridY=obj.showGridY;if(typeof showGridY==="undefined"){showGridY=true}showLabels=obj.showLabels;if(typeof showLabels==="undefined"){showLabels=true}message=obj.message;if(typeof message==="undefined"){if(isStacked(chartType)){message="#val / #total"}else{message="#val"}}adjustableTextFontSize=obj.adjustableTextFontSize;if(typeof adjustableTextFontSize==="undefined"){adjustableTextFontSize=false}tickCount=obj.tickCount;if(typeof tickCount==="undefined"){tickCount=5}seriesColor=obj.color;if(typeof seriesColor==="undefined"){seriesColor=distinctHexColors(series)}y2Count=obj.y2Count;if(typeof y2Count==="undefined"){y2Count=1}if((y2Count>=series)&&(obj.lineData===undefined)){y2Count=series-1}var countNo=series;if((countNo>1)&&obj.dualYaxis&&(obj.lineData===undefined)){countNo=series-y2Count}for(var k=0;k<countNo;k++){maxK[k]=Math.max.apply(Math,obj.data[k]);minK[k]=Math.min.apply(Math,obj.data[k])}if(isStacked(chartType)){for(var i=0;i<data.length;i++){var sum=0;for(var k=0;k<series;k++){sum+=obj.data[k][i]}maxSum[i]=sum}max=Math.max.apply(Math,maxSum)}else{max=Math.max.apply(Math,maxK)}min=Math.min.apply(Math,minK);if(startingFromZero&&(min>0)){min=0}if(obj.lineData!==undefined){var lineMaxK=new Array();var lineMinK=new Array();var countNo=obj.lineData.length;if(obj.dualYaxis){if(y2Count>obj.lineData.length){y2Count=obj.lineData.length}countNo=obj.lineData.length-y2Count}if(countNo>0){for(var k=0;k<countNo;k++){lineMaxK[k]=Math.max.apply(Math,obj.lineData[k]);lineMinK[k]=Math.min.apply(Math,obj.lineData[k])}var lineMin=Math.min.apply(Math,lineMinK);var lineMax=Math.max.apply(Math,lineMaxK);if(lineMin<min){min=lineMin}if(lineMax>max){max=lineMax}}}var objStep=calculateYStep(min,max,tickCount);yStep=objStep.yStep;minValY=objStep.minValY;maxValY=objStep.maxValY;hStep=computeHStep(maxValY,yStep,true);if(obj.dualYaxis){if(obj.lineData===undefined){if(countNo==series){countNo=series-1}for(var k=countNo;k<series;k++){maxK2[k-countNo]=Math.max.apply(Math,obj.data[k]);minK2[k-countNo]=Math.min.apply(Math,obj.data[k])}max2=Math.max.apply(Math,maxK2);min2=Math.min.apply(Math,minK2)}else{for(var k=countNo;k<obj.lineData.length;k++){maxK2[k-countNo]=Math.max.apply(Math,obj.lineData[k]);minK2[k-countNo]=Math.min.apply(Math,obj.lineData[k])}max2=Math.max.apply(Math,maxK2);min2=Math.min.apply(Math,minK2)}if(startingFromZero&&(min2>0)){min2=0}var objStep2=calculateYStep(min2,max2,tickCount);y2Step=objStep2.yStep;minValY2=objStep2.minValY;maxValY2=objStep2.maxValY;hStep2=computeHStep(maxValY2,y2Step,false)}updateSize(canWidth,canHeight);canvas.addEventListener("mousemove",function(evt){var hme=Object.create(handleMouseEvent);hme.mousePos=getMousePos(canvas,evt);hme.tooltip=getTooltip(hme.mousePos);hme.execute(canvas,tipCanvas,evt)},false);canvas.addEventListener("mouseout",function(evt){tipCanvas.style.left="-2000px"},false);canvas.addEventListener("click",onClick,false);if(resizeWidth||resizeHeight){window.addEventListener("resize",resizeCanvas,false)}drawChart()}function updateSize(canWidth,canHeight){if(canWidth!==undefined){if(isPercent(canWidth)){var percent=canWidth.substring(0,canWidth.length-1);var cl=canvas.parentNode;canvas.width=cl.offsetWidth*percent/100;resizeWidth=true}else{canvas.width=canWidth}}if(canHeight!==undefined){if(isPercent(canHeight)){var percent=canHeight.substring(0,canHeight.length-1);canvas.height=window.innerHeight*percent/100;resizeHeight=true}else{canvas.height=canHeight}}if(isH(chartType)){if(typeof obj.legend!=="undefined"){computeVStep()}realHeight=canvas.width;realWidth=canvas.height-hStep/2;if(typeof obj.title!=="undefined"){realWidth=realWidth-getTitleSpace()}if(typeof obj.legend!=="undefined"){realWidth=realWidth-getLegendSpace()}xLegendSpace=getXLegendSpace();c.translate(canvas.width,canvas.height);c.scale(-1,1);c.rotate(-90*Math.PI/180)}else{realWidth=canvas.width;realHeight=canvas.height}gap=realWidth/10-10;tickInit=realHeight/12;tickStep=(realHeight-step-tickInit)/tickCount;if(adjustableTextFontSize){var objStep=calculateYStep(min,max,tickCount);yStep=objStep.yStep;minValY=objStep.minValY;maxValY=objStep.maxValY;hStep=computeHStep(maxValY,yStep,true);if(obj.dualYaxis){var objStep2=calculateYStep(min2,max2,tickCount);y2Step=objStep2.yStep;minValY2=objStep2.minValY;maxValY2=objStep2.maxValY;hStep2=computeHStep(maxValY2,y2Step,false)}}}function animDraw(){if(drawIt(H)){return false}H+=1+(realHeight-step-titleSpace-legendSpace)/30;window.requestAnimFrame(animDraw)}function drawIt(H){drawInit();var stop=drawData(true,false,"");drawGrid();drawAxis();return stop}function drawData(withFill,withClick,mousePos){var font=c.font;c.lineWidth=1;var stop=true;var acc=new Array();for(var i=0;i<data.length;i++){acc[i]=realHeight-step}var barTooltip="";var barValue;var abort=false;for(var k=0;k<series&&!abort;k++){for(var i=0;i<data.length&&!abort;i++){var dp=obj.data[k][i];if(isStacked(chartType)){if(k>0){for(var m=0;m<k;m++){dp+=obj.data[m][i]}}}var rectX=hStep+i*(realWidth-hStep-hStep2)/data.length;var Yheight=realHeight-step-(dp-minValY)*tickStep/yStep;if(obj.dualYaxis&&(y2Count>0)&&(k>=series-y2Count)&&(obj.lineData===undefined)){Yheight=realHeight-step-(dp-minValY2)*tickStep/y2Step}var rectY=realHeight-step-H;if(rectY<=Yheight){rectY=Yheight}else{stop=false}if(rectY+2>xaxisY){rectY=xaxisY-1;cornerRadius=1}else{cornerRadius=6}var rectWidth;if(isStacked(chartType)){rectWidth=(realWidth-hStep-gap*(1+Math.sqrt(series)))/data.length}else{rectWidth=(realWidth-hStep-hStep2-gap*(1+Math.sqrt(series)))/data.length/series;rectX=rectX+k*rectWidth}var lColor=colorLuminance(seriesColor[k],1.3);var grad=c.createLinearGradient(rectX,realWidth-hStep-hStep2,rectX+rectWidth,realWidth-hStep-hStep2);grad.addColorStop(0,lColor);grad.addColorStop(1,seriesColor[k]);var inverseGrad=c.createLinearGradient(rectX,realWidth-hStep-hStep2,rectX+rectWidth,realWidth-hStep-hStep2);inverseGrad.addColorStop(0,seriesColor[k]);inverseGrad.addColorStop(1,lColor);if(chartStyle=="glass"){acc[i]=drawGlass(k,i,rectX,rectY,rectWidth,grad,acc[i],withFill)}else{if(chartStyle=="cylinder"){acc[i]=drawCylinder(k,i,rectX,rectY,rectWidth,grad,inverseGrad,acc[i],withFill)}else{if(chartStyle=="dome"){acc[i]=drawDome(k,i,rectX,rectY,rectWidth,inverseGrad,stop,acc[i],withFill)}else{if(chartStyle=="parallelepiped"){acc[i]=drawParallelipiped(k,i,rectX,rectY,rectWidth,grad,inverseGrad,stop,acc[i],withFill)}else{acc[i]=drawRectangle(k,i,rectX,rectY,rectWidth,acc[i],withFill)}}}}if(!withFill){if(c.isPointInPath(mousePos.x,mousePos.y)){var tValue=obj.data[k][i];if(obj.tooltipPattern!==undefined){tValue=formatNumber(tValue,obj.tooltipPattern.decimals,obj.tooltipPattern.decimalSeparator,obj.tooltipPattern.thousandSeparator)}var returnValue=labels[i];if(withClick){barValue=tValue;if(obj.lineData!==undefined){abort=true}else{return returnValue}}else{var mes=String(message).replace("#val",tValue);mes=mes.replace("#x",returnValue);mes=mes.replace("#total",maxSum[i]);if(obj.onClick!==undefined){canvas.style.cursor="pointer"}barTooltip=mes;if(obj.lineData!==undefined){abort=true}else{return mes}}}else{canvas.style.cursor="default"}}}}if(obj.lineData!==undefined){for(var k=0;k<obj.lineData.length;k++){dotsK[k]=[];for(var i=0;i<obj.lineData[0].length;i++){var dp=obj.lineData[k][i];var width=(realWidth-hStep-hStep2-gap*(1+Math.sqrt(obj.lineData.length)))/obj.lineData[0].length;var dotX=hStep+i*(realWidth-hStep-hStep2)/obj.lineData[0].length+width/2;var Yheight=realHeight-step-(dp-minValY)*tickStep/yStep;if(obj.dualYaxis&&(y2Count>0)&&(k>=obj.lineData.length-y2Count)){Yheight=realHeight-step-(dp-minValY2)*tickStep/y2Step}var dotY=realHeight-step-H;var dotX2=dotX;var dotY2=dotY;var Yheight2=Yheight;if(i<obj.lineData[0].length-1){dotX2=hStep+(i+1)*(realWidth-hStep-hStep2)/obj.lineData[0].length+width/2;dotY2=realHeight-step-H;Yheight2=realHeight-step-(obj.lineData[k][i+1]-minValY)*tickStep/yStep;if(obj.dualYaxis&&(y2Count>0)&&(k>=obj.lineData.length-y2Count)){Yheight2=realHeight-step-(obj.lineData[k][i+1]-minValY2)*tickStep/y2Step}}if(dotY<=Yheight){dotY=Yheight}else{stop=false}if(dotY+2>xaxisY){dotY=xaxisY-1}if(i<obj.lineData[0].length-1){if(dotY2<=Yheight2){dotY2=Yheight2}else{stop=false}if(dotY2+2>xaxisY){dotY2=xaxisY-1}}dotsK[k].push({x:dotX,y:dotY});var lineSeriesColor=obj.lineColor;if(obj.lineColor===undefined){lineSeriesColor=distinctHexColors(obj.lineData[0].length)}var savedStroke=c.strokeStyle;drawLineElements(c,"normal","line",2,lineSeriesColor,dotsK,obj.lineData[0].length,xaxisY,globalAlpha,k,i,dotX,dotY,dotX2,dotY2,withFill);c.strokeStyle=savedStroke;if(!withFill){if(c.isPointInPath(mousePos.x,mousePos.y)){var tValue=obj.lineData[k][i];if(obj.tooltipPattern!==undefined){tValue=formatNumber(tValue,obj.tooltipPattern.decimals,obj.tooltipPattern.decimalSeparator,obj.tooltipPattern.thousandSeparator)}var returnValue=labels[k];if(withClick){return returnValue}else{var lineMessage="#val";var mes=String(lineMessage).replace("#val",tValue);mes=mes.replace("#x",returnValue);if(obj.onClick!==undefined){canvas.style.cursor="pointer"}return mes}}else{if(abort==true){if(obj.onClick!==undefined){canvas.style.cursor="pointer"}}else{canvas.style.cursor="default"}}}}}}if(withFill){return stop}else{if(withClick){if(barValue!==undefined){return barValue}}return barTooltip}}function drawRectangle(k,i,rectX,rectY,rectWidth,acci,withFill){c.beginPath();c.moveTo(rectX,rectY);c.lineTo(rectX+rectWidth,rectY);c.lineTo(rectX+rectWidth,acci);c.lineTo(rectX,acci);c.lineTo(rectX,rectY);if(isStacked(chartType)){acci=rectY}if(withFill){c.fillStyle=seriesColor[k];c.globalAlpha=globalAlpha;c.fill();c.globalAlpha=1}return acci}function drawCylinder(k,i,rectX,rectY,rectWidth,grad,inverseGrad,acci,withFill){if(withFill){c.beginPath();var radius=rectWidth/2/Math.sin(Math.PI/8);c.arc(rectX+rectWidth/2,rectY-radius*Math.cos(Math.PI/8),radius,3*Math.PI/8,5*Math.PI/8);if(isStacked(chartType)){c.lineTo(rectX,acci);c.arc(rectX+rectWidth/2,acci-radius*Math.cos(Math.PI/8),radius,5*Math.PI/8,3*Math.PI/8,true);acci=rectY}else{c.lineTo(rectX,realHeight-step);c.arc(rectX+rectWidth/2,realHeight-step-radius*Math.cos(Math.PI/8),radius,5*Math.PI/8,3*Math.PI/8,true)}c.lineTo(rectX+rectWidth,rectY);c.stroke();c.closePath();if(withFill){c.fillStyle=inverseGrad;c.globalAlpha=globalAlpha;c.fill();c.globalAlpha=1}c.beginPath();if(isStacked(chartType)){c.arc(rectX+rectWidth/2,acci+radius*Math.cos(Math.PI/8),radius,11*Math.PI/8,13*Math.PI/8);c.stroke();c.arc(rectX+rectWidth/2,rectY-radius*Math.cos(Math.PI/8),radius,3*Math.PI/8,5*Math.PI/8)}else{c.arc(rectX+rectWidth/2,rectY+radius*Math.cos(Math.PI/8),radius,11*Math.PI/8,13*Math.PI/8);c.stroke();c.arc(rectX+rectWidth/2,rectY-radius*Math.cos(Math.PI/8),radius,3*Math.PI/8,5*Math.PI/8)}c.closePath();c.fillStyle=grad;c.globalAlpha=globalAlpha;c.fill();c.globalAlpha=1}else{c.beginPath();var radius=rectWidth/2/Math.sin(Math.PI/8);if((series==1)||(k==series-1)){c.arc(rectX+rectWidth/2,rectY+radius*Math.cos(Math.PI/8),radius,13*Math.PI/8,11*Math.PI/8,true)}else{c.arc(rectX+rectWidth/2,rectY-radius*Math.cos(Math.PI/8),radius,3*Math.PI/8,5*Math.PI/8)}if(isStacked(chartType)){c.lineTo(rectX,acci);c.arc(rectX+rectWidth/2,acci-radius*Math.cos(Math.PI/8),radius,5*Math.PI/8,3*Math.PI/8,true);acci=rectY}else{c.lineTo(rectX,realHeight-step);c.arc(rectX+rectWidth/2,realHeight-step-radius*Math.cos(Math.PI/8),radius,5*Math.PI/8,3*Math.PI/8,true)}c.lineTo(rectX+rectWidth,rectY)}return acci}function drawGlass(k,i,rectX,rectY,rectWidth,grad,acci,withFill){if(withFill){c.fillStyle=grad}c.beginPath();if(rectWidth<=2*cornerRadius*series){cornerRadius=2}c.moveTo(rectX+cornerRadius,rectY);c.lineTo(rectX+rectWidth-cornerRadius,rectY);if(!isStacked(chartType)||(k==series-1)){c.arcTo(rectX+rectWidth,rectY,rectX+rectWidth,rectY+cornerRadius,cornerRadius)}else{c.lineTo(rectX+rectWidth,rectY)}if(isStacked(chartType)){c.lineTo(rectX+rectWidth,acci);c.lineTo(rectX,acci);acci=rectY}else{c.lineTo(rectX+rectWidth,realHeight-step);c.lineTo(rectX,realHeight-step)}if(!isStacked(chartType)||(k==series-1)){c.lineTo(rectX,rectY+cornerRadius);c.arcTo(rectX,rectY,rectX+rectWidth-cornerRadius,rectY,cornerRadius)}else{c.lineTo(rectX,rectY)}if(withFill){c.closePath();c.stroke();c.globalAlpha=globalAlpha;c.fill();c.globalAlpha=1}return acci}function drawDome(k,i,rectX,rectY,rectWidth,inverseGrad,stop,acci,withFill){if(withFill){c.fillStyle=inverseGrad;c.beginPath();var topRadius=rectWidth/2;var radius=rectWidth/2/Math.sin(Math.PI/8);var value=(obj.data[k][i]-minValY)*tickStep/yStep;var maxValue=(maxSum[i]-minValY)*tickStep/yStep;var isEllipse=false;if((series==1)||(k==series-1)||(chartType=="bar")){var drawDome=!isStacked(chartType)||(isStacked(chartType)&&stop);if(drawDome){if(topRadius<=value){c.arc(rectX+rectWidth/2,rectY+topRadius,topRadius,2*Math.PI,Math.PI,true)}else{drawUpperEllipse(c,rectX,rectY,rectWidth,2*value);isEllipse=true}}}else{c.arc(rectX+rectWidth/2,rectY+radius*Math.cos(Math.PI/8),radius,13*Math.PI/8,11*Math.PI/8,true)}if(isStacked(chartType)){if(isEllipse==true){c.arc(rectX+rectWidth/2,acci-radius*Math.cos(Math.PI/8),radius,3*Math.PI/8,5*Math.PI/8)}else{c.arc(rectX+rectWidth/2,acci-radius*Math.cos(Math.PI/8),radius,5*Math.PI/8,3*Math.PI/8,true)}acci=rectY}else{c.lineTo(rectX,realHeight-step);c.arc(rectX+rectWidth/2,realHeight-step-radius*Math.cos(Math.PI/8),radius,5*Math.PI/8,3*Math.PI/8,true)}if((series==1)||(k==series-1)||(chartType=="bar")){var drawDome=!isStacked(chartType)||(isStacked(chartType)&&stop);if(drawDome){if(topRadius<=value){c.lineTo(rectX+rectWidth,rectY+topRadius)}else{c.lineTo(rectX,rectY+value)}}}else{c.lineTo(rectX+rectWidth,rectY)}c.stroke();c.closePath();c.globalAlpha=globalAlpha;c.fill();c.globalAlpha=1}else{c.beginPath();var topRadius=rectWidth/2;var radius=rectWidth/2/Math.sin(Math.PI/8);var value=(obj.data[k][i]-minValY)*tickStep/yStep;var isEllipse=false;if((series==1)||(k==series-1)||(chartType=="bar")){var drawDome=!isStacked(chartType)||(isStacked(chartType)&&stop);if(drawDome){if(topRadius<value){c.arc(rectX+rectWidth/2,rectY+topRadius,topRadius,2*Math.PI,Math.PI,true)}else{drawUpperEllipse(c,rectX,rectY,rectWidth,2*value);isEllipse=true}}}else{c.arc(rectX+rectWidth/2,rectY-radius*Math.cos(Math.PI/8),radius,5*Math.PI/8,3*Math.PI/8,true)}if(isStacked(chartType)){if((series==1)||(k==series-1)){if(isEllipse==true){c.arc(rectX+rectWidth/2,acci-radius*Math.cos(Math.PI/8),radius,3*Math.PI/8,5*Math.PI/8)}else{c.arc(rectX+rectWidth/2,acci-radius*Math.cos(Math.PI/8),radius,5*Math.PI/8,3*Math.PI/8,true)}acci=rectY}else{if(isEllipse==true){c.lineTo(rectX,acci);c.arc(rectX+rectWidth/2,realHeight-step-radius*Math.cos(Math.PI/8),radius,13*Math.PI/8,11*Math.PI/8,true)}else{c.lineTo(rectX+rectWidth,acci);c.arc(rectX+rectWidth/2,realHeight-step-radius*Math.cos(Math.PI/8),radius,3*Math.PI/8,5*Math.PI/8)}}}else{c.lineTo(rectX,realHeight-step);c.arc(rectX+rectWidth/2,realHeight-step-radius*Math.cos(Math.PI/8),radius,5*Math.PI/8,3*Math.PI/8,true)}if((series==1)||(k==series-1)||(chartType=="bar")){var drawDome=!isStacked(chartType)||(isStacked(chartType)&&stop);if(drawDome){if(topRadius<=value){c.lineTo(rectX+rectWidth,rectY+topRadius)}}}else{c.lineTo(rectX,rectY)}}return acci}function drawParallelipiped(k,i,rectX,rectY,rectWidth,grad,inverseGrad,stop,acci,withFill){var p=gap/4;var value=(obj.data[k][i]-minValY)*tickStep/yStep;if(withFill){c.fillStyle=grad;c.lineWidth=0.2;c.moveTo(rectX+p,rectY);c.lineTo(rectX+p,acci);if(k==0){c.lineTo(rectX,acci+p);c.moveTo(rectX+p,acci);c.lineTo(rectX+rectWidth+p,acci)}c.stroke();c.lineWidth=0.5;c.beginPath();c.moveTo(rectX,rectY+p);c.lineTo(rectX+rectWidth,rectY+p);c.lineTo(rectX+rectWidth,acci+p);c.lineTo(rectX,acci+p);c.lineTo(rectX,rectY+p);c.closePath();c.stroke();c.globalAlpha=globalAlpha;c.fill();c.globalAlpha=1;c.fillStyle=inverseGrad;c.beginPath();c.moveTo(rectX,rectY+p);c.lineTo(rectX+p,rectY);c.lineTo(rectX+rectWidth+p,rectY);c.lineTo(rectX+rectWidth,rectY+p);c.lineTo(rectX,rectY+p);c.closePath();c.stroke();c.globalAlpha=globalAlpha;c.fill();c.globalAlpha=1;c.fillStyle=inverseGrad;c.beginPath();c.moveTo(rectX+rectWidth+p,rectY);if(isStacked(chartType)){var m=H;if(m>value){m=value}c.lineTo(rectX+rectWidth+p,rectY+m);c.lineTo(rectX+rectWidth,rectY+p+m)}else{c.lineTo(rectX+rectWidth+p,acci);c.lineTo(rectX+rectWidth,acci+p)}c.lineTo(rectX+rectWidth,rectY+p);c.lineTo(rectX+rectWidth+p,rectY);c.closePath();c.stroke();c.globalAlpha=globalAlpha;c.fill();c.globalAlpha=1;if(isStacked(chartType)){acci=rectY}}else{c.beginPath();c.moveTo(rectX,rectY+p);if((series==1)||(k==series-1)||(chartType=="bar")){c.lineTo(rectX+p,rectY-p);if((chartType=="bar")&&(series>1)&&(k<series-1)){var nextValue=(obj.data[k+1][i]-minValY)*tickStep/yStep;if(value<=nextValue){c.lineTo(rectX+rectWidth,rectY-p)}else{c.lineTo(rectX+rectWidth+p,rectY-p)}}else{c.lineTo(rectX+rectWidth+p,rectY-p)}}else{c.lineTo(rectX+rectWidth,rectY);c.lineTo(rectX+rectWidth+p,rectY-p)}if((chartType=="bar")&&(series>1)&&(k<series-1)){var nextValue=(obj.data[k+1][i]-minValY)*tickStep/yStep;if(value<=nextValue){c.lineTo(rectX+rectWidth,acci+p)}else{c.lineTo(rectX+rectWidth+p,acci-nextValue-p);c.lineTo(rectX+rectWidth,acci-nextValue);c.lineTo(rectX+rectWidth,acci+p)}}else{c.lineTo(rectX+rectWidth+p,acci);c.lineTo(rectX+rectWidth,acci+p)}c.lineTo(rectX,acci+p);c.lineTo(rectX,rectY+p);if(isStacked(chartType)){acci=rectY}}return acci}function drawInit(){var font=c.font;c.fillStyle=background;if(isH(chartType)){c.fillRect(0,0,realWidth+getTitleSpace()+step,realHeight)}else{c.fillRect(0,0,realWidth,realHeight)}var xLabelWidth=computeVStep();if(typeof obj.title!=="undefined"){var titleColor=obj.title.color;if(titleColor===undefined){titleColor="#000000"}c.fillStyle=titleColor;var b=" ";var f=obj.title.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableTitleFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;if(!isH(chartType)){var titlePadding=20;if(adjustableTextFontSize){titlePadding=getAdjustableTitleFontSize()/2}titleSpace=+titlePadding+ +f.size}else{titleSpace=10;if(yLegendSpace==0){titleSpace=20}if(adjustableTextFontSize){titleSpace=getAdjustableTitleFontSize()/4}}var alignment=obj.title.alignment;if(alignment===undefined){alignment="center"}var xTitle;if(alignment=="left"){xTitle=hStep}else{if(alignment=="right"){xTitle=canvas.width-c.measureText(obj.title.text).width-10}else{xTitle=canvas.width/2-c.measureText(obj.title.text).width/2}}if(isH(chartType)){c.save();c.translate(0,realHeight/2);c.scale(1,-1);var xoff=0;if(chartType=="hstackedbar"){xoff=11}else{xoff=11}var leg=0;if(typeof obj.legend!=="undefined"){leg=getLegendSpace()}if(showTicks==false){var titlePadding=20;if(adjustableTextFontSize){titlePadding=getAdjustableTitleFontSize()/2}leg=leg+titleSpace+titlePadding}c.translate(realWidth+hStep+titleSpace+xoff-yLegendSpace+leg,-realHeight/2);c.rotate(Math.PI/2)}var titlePadding=20;if(isH(chartType)&&(yLegendSpace==0)){titlePadding=40}if(adjustableTextFontSize){titlePadding=getAdjustableTitleFontSize()/2}c.fillText(obj.title.text,xTitle,titlePadding+titleSpace/2);c.font=font;if(isH(chartType)){c.restore()}}else{titleSpace=10}if(typeof obj.xLegend!=="undefined"){var xLegendColor=obj.xLegend.color;if(xLegendColor===undefined){xLegendColor="#000000"}c.fillStyle=xLegendColor;var b=" ";var f=obj.xLegend.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()/2}xLegendSpace=+legendPadding+ +f.size;if(isH(chartType)){c.save();c.translate(0,realHeight);c.scale(1,-1);var x=0;if(typeof obj.legend!=="undefined"){x=c.measureText(obj.xLegend.text).width/2}else{if(typeof obj.title!=="undefined"){x=titleSpace}}c.translate(x,-realHeight+f.size/2+xLegendSpace)}c.fillText(obj.xLegend.text,realWidth/2-c.measureText(obj.xLegend.text).width/2,realHeight-f.size);c.font=font;if(isH(chartType)){c.restore()}}else{xLegendSpace=0}if(typeof obj.yLegend!=="undefined"){var yLegendColor=obj.yLegend.color;if(yLegendColor===undefined){yLegendColor="#000000"}var b=" ";var f=obj.yLegend.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;c.fillStyle=yLegendColor;c.save();c.translate(10,realHeight/2);c.rotate(-Math.PI/2);c.textAlign="center";if(isH(chartType)){c.translate(0,realHeight);c.scale(1,-1);var ypos=realHeight-f.size/2-xLegendSpace/2;if((typeof obj.title==="undefined")&&(xLegendSpace==0)){ypos=ypos-f.size}c.translate(0,ypos)}c.fillText(obj.yLegend.text,0,f.size);c.restore();c.font=font}else{yLegendSpace=0}if(obj.dualYaxis&&(typeof obj.y2Legend!=="undefined")){var y2LegendColor=obj.y2Legend.color;if(y2LegendColor===undefined){y2LegendColor="#000000"}var b=" ";var f=obj.y2Legend.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;c.fillStyle=y2LegendColor;c.save();c.translate(realWidth-f.size-10,realHeight/2);c.rotate(-Math.PI/2);c.textAlign="center";c.fillText(obj.y2Legend.text,0,f.size);c.restore();c.font=font}else{y2LegendSpace=0}if(typeof obj.legend!=="undefined"){var x=hStep;if(isH(chartType)){x=step}c.font="bold 10px sans-serif";if(adjustableTextFontSize){c.font="bold "+getAdjustableLabelFontSize()+"px sans-serif"}var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()}legendSpace=legendPadding;var legendY=titleSpace+legendPadding;c.globalAlpha=globalAlpha;for(var k=0;k<series;k++){c.fillStyle=seriesColor[k];var legendWidth=c.measureText("---- "+obj.legend[k]).width+24;if(isH(chartType)){if(x+legendWidth>realHeight){x=step;var lineSpace=14;if(adjustableTextFontSize){lineSpace=getAdjustableLabelFontSize()}legendY=legendY+lineSpace}c.save();c.translate(0,realHeight/2);c.scale(1,-1);var xoff=0;if(chartType=="hstackedbar"){xoff=24;if(typeof obj.title==="undefined"){xoff=4}}else{xoff=23;if(typeof obj.title==="undefined"){xoff=3}}c.translate(realWidth+hStep/2+xoff-yLegendSpace/2+legendSpace,-realHeight/2);c.rotate(Math.PI/2)}else{if(x+legendWidth>realWidth){x=hStep;var lineSpace=14;if(adjustableTextFontSize){lineSpace=getAdjustableLabelFontSize()}legendY=legendY+lineSpace;if(!isH(chartType)){var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()}legendSpace+=legendPadding}}}c.fillText("---- "+obj.legend[k],x,legendY);x=x+legendWidth;if(isH(chartType)){c.restore()}}if((obj.lineLegend!==undefined)&&(obj.lineData!==undefined)){var lineSeriesColor=obj.lineColor;if(obj.lineColor===undefined){lineSeriesColor=distinctHexColors(obj.lineData[0].length)}for(var k=0;k<obj.lineData.length;k++){c.fillStyle=lineSeriesColor[k];var legendWidth=c.measureText(obj.lineLegend[k]).width+24;if(x+legendWidth>realWidth){x=hStep;var lineSpace=14;if(adjustableTextFontSize){lineSpace=getAdjustableLabelFontSize()}legendY=legendY+lineSpace;var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()}legendSpace+=legendPadding}c.fillText("---- "+obj.lineLegend[k],x,legendY);x=x+legendWidth}}c.globalAlpha=1;c.font=font}c.font=font;tickStep=(realHeight-step-titleSpace-legendSpace-tickInit)/tickCount;xaxisY=tickCount*tickStep+tickInit+titleSpace+legendSpace;drawLabels(xLabelWidth)}function drawLabels(xLabelWidth){var font=c.font;if(showTicks){c.fillStyle="black";if(obj.yData!==undefined){c.fillStyle=obj.yData.color;var b=" ";var yfont=obj.yData.font;if(adjustableTextFontSize){yfont.size=getAdjustableLabelFontSize()}c.font=yfont.weight+b+yfont.size+"px"+b+yfont.family}for(var i=0;i<tickCount+1;i++){var label;var label2;if(obj.tooltipPattern!==undefined){var decimals=obj.tooltipPattern.decimals;var exp=Math.pow(10,decimals);label=Math.round((maxValY-i*yStep)*exp)/exp;if(obj.dualYaxis){label2=Math.round((maxValY2-i*y2Step)*exp)/exp}}else{label=Math.round((maxValY-i*yStep)*100)/100;if(obj.dualYaxis){label2=Math.round((maxValY2-i*y2Step)*100)/100}}var labelWidth=c.measureText(label).width;if(isH(chartType)){c.save();var size=0;if(obj.yData!==undefined){if(adjustableTextFontSize){size=getAdjustableLabelFontSize()}}c.scale(-1,1);var m=yLegendSpace;if(m==0){m=0}else{if(xLegendSpace!=0){m=30}}var t=0;if((obj.title===undefined)&&(yLegendSpace==0)){t=maxLabelWidth/3}c.translate(-realHeight+step-maxLabelWidth/2-m+(tickCount-i)*tickStep,i*tickStep+tickInit+hStep+1-labelWidth/3-yLegendSpace/4-t+step-xLabelWidth-xLegendSpace+legendSpace-size/4);c.rotate(-Math.PI/2)}c.fillText(label+"",hStep-15-labelWidth,i*tickStep+tickInit+titleSpace+legendSpace);if(isH(chartType)){c.restore()}c.lineWidth=2;c.beginPath();c.moveTo(hStep-15,i*tickStep+tickInit+titleSpace+legendSpace);c.lineTo(hStep-10,i*tickStep+tickInit+titleSpace+legendSpace);c.closePath();c.stroke();if(obj.dualYaxis){var labelWidth2=c.measureText(label2).width;c.fillText(label2+"",realWidth-hStep2+5,i*tickStep+tickInit+titleSpace+legendSpace);c.lineWidth=2;c.beginPath();c.moveTo(realWidth-hStep2,i*tickStep+tickInit+titleSpace+legendSpace);c.lineTo(realWidth-hStep2+5,i*tickStep+tickInit+titleSpace+legendSpace);c.closePath();c.stroke()}}c.font=font}if(showLabels){c.fillStyle="black";if(obj.xData!==undefined){c.fillStyle=obj.xData.color;var b=" ";var xfont=obj.xData.font;if(adjustableTextFontSize){xfont.size=getAdjustableLabelFontSize()}c.font=xfont.weight+b+xfont.size+"px"+b+xfont.family}for(var i=0;i<labels.length;i++){var middleX=hStep+i*(realWidth-hStep-hStep2)/data.length+(realWidth-hStep-hStep2-gap*(1+Math.sqrt(series)))/data.length/2;if(isH(chartType)){c.save();c.scale(1,-1);c.translate(0,-2*realHeight+xLabelWidth+3*xLegendSpace/2);var size=20;if(adjustableTextFontSize){size=getAdjustableLabelFontSize()}if(obj.xData!==undefined){size=obj.xData.font.size;if(adjustableTextFontSize){size=getAdjustableLabelFontSize()}}c.translate(realHeight-step-size/2+middleX+xLabelWidth/2+xLegendSpace/2,realHeight-middleX-c.measureText(labels[i]).width/2-size/2-xLegendSpace/2);c.rotate(Math.PI/2);c.fillText(labels[i],middleX-c.measureText(labels[i]).width/2,realHeight-step/2-2);c.restore()}else{var xLabelSpace=computeXLabelSpace(labels[i]);if(labelOrientation=="vertical"){c.save();c.translate(middleX-c.measureText(labels[i]).width/2,realHeight-step/2-xLegendSpace/2);c.rotate(-Math.PI/2);c.textAlign="center";c.fillText(labels[i],0,c.measureText(labels[i]).width/2+6);c.restore()}else{if(labelOrientation=="diagonal"){c.save();c.translate(middleX-(c.measureText(labels[i]).width/2)*Math.cos(Math.PI/4),realHeight-step+(c.measureText(labels[i]).width/2)*Math.sin(Math.PI/4));c.rotate(-Math.PI/4);c.textAlign="center";c.fillText(labels[i],0,16);c.restore()}else{if(labelOrientation=="halfdiagonal"){c.save();c.translate(middleX-(c.measureText(labels[i]).width/2)*Math.cos(Math.PI/8),realHeight-step+(c.measureText(labels[i]).width/2)*Math.sin(Math.PI/8));c.rotate(-Math.PI/8);c.textAlign="center";c.fillText(labels[i],0,16);c.restore()}else{c.fillText(labels[i],middleX-c.measureText(labels[i]).width/2,realHeight-step/2-xLegendSpace/4)}}}}}c.font=font}}function drawGrid(){if(showGridY){for(var i=0;i<tickCount+1;i++){var xColor=c.strokeStyle;if(obj.colorGridY!=="undefined"){c.strokeStyle=obj.colorGridY}c.lineWidth=0.2;c.beginPath();c.moveTo(hStep-10,i*tickStep+tickInit+titleSpace+legendSpace);var diff=10;if(obj.dualYaxis){diff=hStep2}c.lineTo(realWidth-diff,i*tickStep+tickInit+titleSpace+legendSpace);c.closePath();c.stroke();c.lineWidth=2;c.strokeStyle=xColor}}if(showGridX){for(var i=0;i<labels.length;i++){var middleX=hStep+i*(realWidth-hStep-hStep2)/data.length+(realWidth-hStep-hStep2-gap*(1+Math.sqrt(series)))/data.length/2;var yColor=c.strokeStyle;if(obj.colorGridX!=="undefined"){c.strokeStyle=obj.colorGridX}c.lineWidth=0.2;c.beginPath();c.moveTo(middleX,10+titleSpace+legendSpace);c.lineTo(middleX,realHeight-step);c.closePath();c.stroke();c.lineWidth=2;c.strokeStyle=yColor}}}function drawAxis(){c.fillStyle="black";c.lineWidth=2;var axisColor=c.strokeStyle;if(obj.colorYaxis!=="undefined"){c.strokeStyle=obj.colorYaxis}c.beginPath();c.moveTo(hStep-10,titleSpace+legendSpace);c.lineTo(hStep-10,realHeight-step);c.closePath();c.stroke();if(obj.colorXaxis!=="undefined"){c.strokeStyle=obj.colorXaxis}c.beginPath();c.moveTo(hStep-10,realHeight-step);if(isH(chartType)){c.lineTo(realWidth,realHeight-step)}else{var diff=5;if(obj.dualYaxis){diff=hStep2-5}c.lineTo(realWidth-diff,realHeight-step)}c.closePath();c.stroke();if(obj.dualYaxis){if(obj.colorY2axis!=="undefined"){c.strokeStyle=obj.colorY2axis}c.beginPath();c.moveTo(realWidth-hStep2,titleSpace+legendSpace);c.lineTo(realWidth-hStep2,realHeight-step);c.closePath();c.stroke()}c.strokeStyle=axisColor}function getTooltip(mousePos){return drawData(false,false,mousePos)}function onClick(evt){var v=drawData(false,true,getMousePos(canvas,evt));if((v!=="")&&(obj.onClick!==undefined)){var f=obj.onClick;eval(f);doClick(v)}return v}function drawChart(){window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){window.setTimeout(callback,1000/60)}})();window.requestAnimFrame(animDraw)}function computeHStep(maxValY,yStep,takeCare){var result;var font=c.font;if(showTicks){maxLabelWidth=0;if(typeof obj.yData!=="undefined"){var yfont=obj.yData.font;if(adjustableTextFontSize){yfont.size=getAdjustableLabelFontSize()}var b=" ";c.font=yfont.weight+b+yfont.size+"px"+b+yfont.family}for(var i=0;i<tickCount+1;i++){var label=Math.round((maxValY-i*yStep)*100)/100;var labelWidth=c.measureText(label).width;if(labelWidth>maxLabelWidth){maxLabelWidth=labelWidth}}result=maxLabelWidth+20}else{result=20}c.font=font;if(obj.dualYaxis&&!takeCare){if(typeof obj.y2Legend!=="undefined"){var b=" ";var f=obj.y2Legend.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;y2LegendSpace=f.size;c.font=font;result+=y2LegendSpace}}if(takeCare){if(typeof obj.yLegend!=="undefined"){var b=" ";var f=obj.yLegend.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()}yLegendSpace=+legendPadding+ +f.size;c.font=font;result+=yLegendSpace}var cf=c.font;if(obj.xData!==undefined){var b=" ";var xfont=obj.xData.font;if(adjustableTextFontSize){xfont.size=getAdjustableLabelFontSize()}c.font=xfont.weight+b+xfont.size+"px"+b+xfont.family}var minPos=new Array();for(var i=0;i<labels.length;i++){if(isH(chartType)){realWidth=canvas.height-result/2;if(typeof obj.title!=="undefined"){realWidth=realWidth-getTitleSpace()}if(typeof obj.legend!=="undefined"){realWidth=realWidth-getLegendSpace()}}else{realWidth=canvas.width}var middleX=result+i*(realWidth-result)/data.length+(realWidth-result-gap*(1+Math.sqrt(series)))/data.length/2;var angle;if(labelOrientation=="diagonal"){angle=Math.PI/4}else{if(labelOrientation=="halfdiagonal"){angle=Math.PI/8}}if(angle!==undefined){var len=middleX-c.measureText(labels[i]).width*Math.cos(angle);minPos.push(len)}}var len=Math.min.apply(Math,minPos);if(minPos.length>0){if(len<10){result+=(10-len)}}}return result}function computeVStep(){var xLabelWidth=0;if(typeof obj.xData!=="undefined"){var xfont=obj.xData.font;if(adjustableTextFontSize){xfont.size=getAdjustableLabelFontSize()}var b=" ";c.font=xfont.weight+b+xfont.size+"px"+b+xfont.family}if(showLabels){for(var i=0;i<labels.length;i++){var labelWidth=computeXLabelSpace(labels[i]);if(labelWidth>xLabelWidth){xLabelWidth=labelWidth}}}var _xLegendSpace=0;if(typeof obj.xLegend!=="undefined"){var f=obj.xLegend.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize()}var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()}_xLegendSpace=+legendPadding+ +f.size}if((step<xLabelWidth+_xLegendSpace)||adjustableTextFontSize){step=xLabelWidth+_xLegendSpace}return xLabelWidth}function computeXLabelSpace(label){var _labelWidth=c.measureText(label).width+10;if(!isH(chartType)){if(labelOrientation==="horizontal"){if(typeof obj.xData!=="undefined"){_labelWidth=obj.xData.font.size+20;if(adjustableTextFontSize){_labelWidth=getAdjustableLabelFontSize()+20}}else{_labelWidth=12+20}}else{if(labelOrientation==="halfdiagonal"){_labelWidth=c.measureText(label).width*Math.sin(Math.PI/8)+20}else{if(labelOrientation==="diagonal"){_labelWidth=c.measureText(label).width*Math.sin(Math.PI/4)+20}}}}return _labelWidth}function getTitleSpace(){var space=10;if(typeof obj.title!=="undefined"){var f=obj.title.font;if(f===undefined){f.size=12}if(adjustableTextFontSize){f.size=getAdjustableTitleFontSize()}var titlePadding=20;if(adjustableTextFontSize){titlePadding=getAdjustableTitleFontSize()}space=+titlePadding+ +f.size}return space}function getXLegendSpace(){var _xLegendSpace=0;if(typeof obj.xLegend!=="undefined"){var f=obj.xLegend.font;if(f===undefined){f.size=12}var legendPadding=20;if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize();legendPadding=getAdjustableLabelFontSize()}_xLegendSpace=+legendPadding+ +f.size}return _xLegendSpace}function getLegendSpace(){var font=c.font;var _legendSpace=20;if(typeof obj.legend!=="undefined"){var x=hStep;if(isH(chartType)){x=step}c.font="bold 10px sans-serif";if(adjustableTextFontSize){c.font="bold "+getAdjustableLabelFontSize()+"px sans-serif"}var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()/2}var legendY=getTitleSpace()+legendPadding;for(var k=0;k<series;k++){var legendWidth=c.measureText(obj.legend[k]).width+24;if(isH(chartType)){if(x+legendWidth>realHeight){x=step;var lineSpace=14;if(adjustableTextFontSize){lineSpace=getAdjustableLabelFontSize()}legendY=legendY+lineSpace}}else{if(x+legendWidth>realWidth){x=hStep;var lineSpace=14;if(adjustableTextFontSize){lineSpace=getAdjustableLabelFontSize()}legendY=legendY+lineSpace;if(!isH(chartType)){var pad=20;if(adjustableTextFontSize){pad=getAdjustableLabelFontSize()}_legendSpace+=pad}}}x=x+legendWidth}if(obj.lineLegend!==undefined){for(var k=0;k<obj.lineData.length;k++){var legendWidth=c.measureText(obj.lineLegend[k]).width+24;if(x+legendWidth>realWidth){x=hStep;var lineSpace=14;if(adjustableTextFontSize){lineSpace=getAdjustableLabelFontSize()}legendY=legendY+lineSpace;_legendSpace+=lineSpace}}x=x+legendWidth}}c.font=font;return _legendSpace}function isStacked(chartType){return(chartType=="stackedbar")||(chartType=="hstackedbar")}function isH(chartType){return(chartType=="hbar")||(chartType=="hstackedbar")}function resizeCanvas(){var can=document.getElementById(idCan);if(can!=null){var w=canWidth;if(resizeWidth){if(!isPercent(w)){w="100%"}}var h=canHeight;if(resizeHeight){if(!isPercent(h)){h="100%"}}updateSize(w,h);drawChart()}}function getAdjustableTitleFontSize(){return canvas.width/25}function getAdjustableLabelFontSize(){return canvas.width/45}drawBar(myjson,idCan,idTipCan,canWidth,canHeight)};var lineChart=function(myjson,idCan,idTipCan,canWidth,canHeight){var obj;var data;var labels;var labelOrientation;var globalAlpha;var showGridX;var showGridY;var showLabels;var background;var message;var tickCount;var showTicks;var startingFromZero;var chartType;var chartStyle;var seriesColor;var xData,yData;var series;var yStep;var maxK=new Array();var minK=new Array();var dotsK=new Array();var max;var min;var tickStep;var minValY;var maxValY;var y2Step;var maxK2=new Array();var minK2=new Array();var max2;var min2;var minValY2;var maxValY2;var hStep2=0;var y2LegendSpace=0;var y2Count=1;var step=0;var gap=40;var hStep=60;var titleSpace=0;var legendSpace=0;var xLegendSpace=0;var yLegendSpace=0;var xaxisY=0;var realWidth;var realHeight;var canvas;var c;var tipCanvas;var H=6;var dotRadius=3;var tickInit;var resizeWidth=false;var resizeHeight=false;var adjustableTextFontSize=false;function drawLine(myjson,idCan,idTipCan,canWidth,canHeight){canvas=document.getElementById(idCan);if(canvas==null){return}tipCanvas=document.getElementById(idTipCan);c=canvas.getContext("2d");obj=myjson;chartType=obj.type;if(typeof chartType==="undefined"){chartType="line"}background=obj.background;if(typeof background==="undefined"){background="white"}chartStyle=obj.style;if((typeof chartStyle==="undefined")||(find(["normal","soliddot","hollowdot","anchordot","bowdot","stardot"],chartStyle)===false)){chartStyle="normal"}data=obj.data[0];series=obj.data.length;labels=obj.labels;if(typeof labels==="undefined"){labels=[];for(var i=0;i<data.length;i++){labels.push("")}}labelOrientation=obj.labelOrientation;if(typeof labelOrientation==="undefined"){labelOrientation="horizontal"}globalAlpha=obj.alpha;if(typeof globalAlpha==="undefined"){globalAlpha=0.8}showTicks=obj.showTicks;if(typeof showTicks==="undefined"){showTicks=true}startingFromZero=obj.startingFromZero;if(typeof startingFromZero==="undefined"){startingFromZero=false}showGridX=obj.showGridX;if(typeof showGridX==="undefined"){showGridX=true}showGridY=obj.showGridY;if(typeof showGridY==="undefined"){showGridY=true}showLabels=obj.showLabels;if(typeof showLabels==="undefined"){showLabels=true}message=obj.message;if(typeof message==="undefined"){message="#val"}adjustableTextFontSize=obj.adjustableTextFontSize;if(typeof adjustableTextFontSize==="undefined"){adjustableTextFontSize=false}tickCount=obj.tickCount;if(typeof tickCount==="undefined"){tickCount=5}seriesColor=obj.color;if(typeof seriesColor==="undefined"){seriesColor=distinctHexColors(series)}y2Count=obj.y2Count;if(typeof y2Count==="undefined"){y2Count=1}if(y2Count>=series){y2Count=series-1}var countNo=series;if((countNo>1)&&obj.dualYaxis){countNo=series-y2Count}for(var k=0;k<countNo;k++){maxK[k]=Math.max.apply(Math,obj.data[k]);minK[k]=Math.min.apply(Math,obj.data[k])}max=Math.max.apply(Math,maxK);min=Math.min.apply(Math,minK);if(startingFromZero&&(min>0)){min=0}var objStep=calculateYStep(min,max,tickCount);yStep=objStep.yStep;minValY=objStep.minValY;maxValY=objStep.maxValY;hStep=computeHStep(maxValY,yStep,true);if(obj.dualYaxis&&(countNo>0)){if(countNo==series){countNo=series-1}for(var k=countNo;k<series;k++){maxK2[k-countNo]=Math.max.apply(Math,obj.data[k]);minK2[k-countNo]=Math.min.apply(Math,obj.data[k])}max2=Math.max.apply(Math,maxK2);min2=Math.min.apply(Math,minK2);if(startingFromZero&&(min2>0)){min2=0}var objStep2=calculateYStep(min2,max2,tickCount);y2Step=objStep2.yStep;minValY2=objStep2.minValY;maxValY2=objStep2.maxValY;hStep2=computeHStep(maxValY2,y2Step,false)}updateSize(canWidth,canHeight);canvas.addEventListener("mousemove",function(evt){var hme=Object.create(handleMouseEvent);hme.mousePos=getMousePos(canvas,evt);hme.tooltip=getTooltip(hme.mousePos);hme.execute(canvas,tipCanvas,evt)},false);canvas.addEventListener("mouseout",function(evt){tipCanvas.style.left="-2000px"},false);canvas.addEventListener("click",onClick,false);if(resizeWidth||resizeHeight){window.addEventListener("resize",resizeCanvas,false)}drawChart()}function updateSize(canWidth,canHeight){if(canWidth!==undefined){if(isPercent(canWidth)){var percent=canWidth.substring(0,canWidth.length-1);var cl=canvas.parentNode;canvas.width=cl.offsetWidth*percent/100;resizeWidth=true}else{canvas.width=canWidth}}if(canHeight!==undefined){if(isPercent(canHeight)){var percent=canHeight.substring(0,canHeight.length-1);canvas.height=window.innerHeight*percent/100;resizeHeight=true}else{canvas.height=canHeight}}realWidth=canvas.width;realHeight=canvas.height;gap=realWidth/10-10;tickInit=realHeight/12;tickStep=(realHeight-step-tickInit)/tickCount;if(adjustableTextFontSize){var objStep=calculateYStep(min,max,tickCount);yStep=objStep.yStep;minValY=objStep.minValY;maxValY=objStep.maxValY;hStep=computeHStep(maxValY,yStep,true);if(obj.dualYaxis){var objStep2=calculateYStep(min2,max2,tickCount);y2Step=objStep2.yStep;minValY2=objStep2.minValY;maxValY2=objStep2.maxValY;hStep2=computeHStep(maxValY2,y2Step,false)}}}function animDraw(){if(drawIt(H)){return false}H+=1+(realHeight-step-titleSpace-legendSpace)/30;window.requestAnimFrame(animDraw)}function drawIt(H){drawInit();var stop=drawData(true,false,"");drawGrid();drawAxis();return stop}function drawData(withFill,withClick,mousePos){var font=c.font;c.lineWidth=1;var stop=true;for(var k=0;k<series;k++){dotsK[k]=[];for(var i=0;i<data.length;i++){var dp=obj.data[k][i];var width=(realWidth-hStep-hStep2-gap*(1+Math.sqrt(series)))/data.length;var dotX=hStep+i*(realWidth-hStep-hStep2)/data.length+width/2;var Yheight=realHeight-step-(dp-minValY)*tickStep/yStep;if(obj.dualYaxis&&(y2Count>0)&&(k>=series-y2Count)){Yheight=realHeight-step-(dp-minValY2)*tickStep/y2Step}var dotY=realHeight-step-H;var dotX2=dotX;var dotY2=dotY;var Yheight2=Yheight;if(i<data.length-1){dotX2=hStep+(i+1)*(realWidth-hStep-hStep2)/data.length+width/2;dotY2=realHeight-step-H;Yheight2=realHeight-step-(obj.data[k][i+1]-minValY)*tickStep/yStep;if(obj.dualYaxis&&(y2Count>0)&&(k>=series-y2Count)){Yheight2=realHeight-step-(obj.data[k][i+1]-minValY2)*tickStep/y2Step}}if(dotY<=Yheight){dotY=Yheight}else{stop=false}if(dotY+2>xaxisY){dotY=xaxisY-1}if(i<data.length-1){if(dotY2<=Yheight2){dotY2=Yheight2}else{stop=false}if(dotY2+2>xaxisY){dotY2=xaxisY-1}}dotsK[k].push({x:dotX,y:dotY});var savedStroke=c.strokeStyle;if((chartStyle=="normal")||(chartType=="area")){dotRadius=2}drawLineElements(c,chartStyle,chartType,dotRadius,seriesColor,dotsK,data.length,xaxisY,globalAlpha,k,i,dotX,dotY,dotX2,dotY2,withFill);c.strokeStyle=savedStroke;if(!withFill){if(c.isPointInPath(mousePos.x,mousePos.y)){var tValue=obj.data[k][i];if(obj.tooltipPattern!==undefined){tValue=formatNumber(tValue,obj.tooltipPattern.decimals,obj.tooltipPattern.decimalSeparator,obj.tooltipPattern.thousandSeparator)}var returnValue=labels[i];if(withClick){return returnValue}else{var mes=String(message).replace("#val",tValue);mes=mes.replace("#x",returnValue);if(obj.onClick!==undefined){canvas.style.cursor="pointer"}return mes}}else{canvas.style.cursor="default"}}}}if(withFill){return stop}else{return""}}function drawInit(){var font=c.font;c.fillStyle=background;c.fillRect(0,0,realWidth,realHeight);var xLabelWidth=computeVStep();if(typeof obj.title!=="undefined"){var titleColor=obj.title.color;if(titleColor===undefined){titleColor="#000000"}c.fillStyle=titleColor;var b=" ";var f=obj.title.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableTitleFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;var titlePadding=20;if(adjustableTextFontSize){titlePadding=getAdjustableTitleFontSize()/2}titleSpace=+titlePadding+ +f.size;var alignment=obj.title.alignment;if(alignment===undefined){alignment="center"}var xTitle;if(alignment=="left"){xTitle=hStep}else{if(alignment=="right"){xTitle=canvas.width-c.measureText(obj.title.text).width-10}else{xTitle=canvas.width/2-c.measureText(obj.title.text).width/2}}var titlePadding=20;if(adjustableTextFontSize){titlePadding=getAdjustableTitleFontSize()/2}c.fillText(obj.title.text,xTitle,titlePadding+titleSpace/2);c.font=font}else{titleSpace=10}if(typeof obj.xLegend!=="undefined"){var xLegendColor=obj.xLegend.color;if(xLegendColor===undefined){xLegendColor="#000000"}c.fillStyle=xLegendColor;var b=" ";var f=obj.xLegend.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()/2}xLegendSpace=+legendPadding+ +f.size;c.fillText(obj.xLegend.text,realWidth/2-c.measureText(obj.xLegend.text).width/2,realHeight-f.size);c.font=font}else{xLegendSpace=0}if(typeof obj.yLegend!=="undefined"){var yLegendColor=obj.yLegend.color;if(yLegendColor===undefined){yLegendColor="#000000"}var b=" ";var f=obj.yLegend.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;c.fillStyle=yLegendColor;c.save();c.translate(10,realHeight/2);c.rotate(-Math.PI/2);c.textAlign="center";c.fillText(obj.yLegend.text,0,f.size);c.restore();c.font=font}else{yLegendSpace=0}if(obj.dualYaxis&&(typeof obj.y2Legend!=="undefined")){var y2LegendColor=obj.y2Legend.color;if(y2LegendColor===undefined){y2LegendColor="#000000"}var b=" ";var f=obj.y2Legend.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;c.fillStyle=y2LegendColor;c.save();c.translate(realWidth-f.size-10,realHeight/2);c.rotate(-Math.PI/2);c.textAlign="center";c.fillText(obj.y2Legend.text,0,f.size);c.restore();c.font=font}else{y2LegendSpace=0}if(typeof obj.legend!=="undefined"){var x=hStep;c.font="bold 10px sans-serif";if(adjustableTextFontSize){c.font="bold "+getAdjustableLabelFontSize()+"px sans-serif"}var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()}legendSpace=legendPadding;var legendY=titleSpace+legendPadding;c.globalAlpha=globalAlpha;for(var k=0;k<series;k++){c.fillStyle=seriesColor[k];var legendWidth=c.measureText("---- "+obj.legend[k]).width+24;if(x+legendWidth>realWidth){x=hStep;var lineSpace=14;if(adjustableTextFontSize){lineSpace=getAdjustableLabelFontSize()}legendY=legendY+lineSpace;var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()}legendSpace+=legendPadding}c.fillText("---- "+obj.legend[k],x,legendY);x=x+legendWidth}c.globalAlpha=1;c.font=font}c.font=font;tickStep=(realHeight-step-titleSpace-legendSpace-tickInit)/tickCount;xaxisY=tickCount*tickStep+tickInit+titleSpace+legendSpace;drawLabels(xLabelWidth)}function drawLabels(xLabelWidth){var font=c.font;if(showTicks){c.fillStyle="black";if(obj.yData!==undefined){c.fillStyle=obj.yData.color;var b=" ";var yfont=obj.yData.font;if(adjustableTextFontSize){yfont.size=getAdjustableLabelFontSize()}c.font=yfont.weight+b+yfont.size+"px"+b+yfont.family}for(var i=0;i<tickCount+1;i++){var label;var label2;if(obj.tooltipPattern!==undefined){var decimals=obj.tooltipPattern.decimals;var exp=Math.pow(10,decimals);label=Math.round((maxValY-i*yStep)*exp)/exp;if(obj.dualYaxis){label2=Math.round((maxValY2-i*y2Step)*exp)/exp}}else{label=Math.round((maxValY-i*yStep)*100)/100;if(obj.dualYaxis){label2=Math.round((maxValY2-i*y2Step)*100)/100}}var labelWidth=c.measureText(label).width;c.fillText(label+"",hStep-15-labelWidth,i*tickStep+tickInit+titleSpace+legendSpace);c.lineWidth=2;c.beginPath();c.moveTo(hStep-15,i*tickStep+tickInit+titleSpace+legendSpace);c.lineTo(hStep-10,i*tickStep+tickInit+titleSpace+legendSpace);c.closePath();c.stroke();if(obj.dualYaxis){var labelWidth2=c.measureText(label2).width;c.fillText(label2+"",realWidth-hStep2+5,i*tickStep+tickInit+titleSpace+legendSpace);c.lineWidth=2;c.beginPath();c.moveTo(realWidth-hStep2,i*tickStep+tickInit+titleSpace+legendSpace);c.lineTo(realWidth-hStep2+5,i*tickStep+tickInit+titleSpace+legendSpace);c.closePath();c.stroke()}}c.font=font}if(showLabels){c.fillStyle="black";if(obj.xData!==undefined){c.fillStyle=obj.xData.color;var b=" ";var xfont=obj.xData.font;if(adjustableTextFontSize){xfont.size=getAdjustableLabelFontSize()}c.font=xfont.weight+b+xfont.size+"px"+b+xfont.family}for(var i=0;i<labels.length;i++){var middleX=hStep+i*(realWidth-hStep-hStep2)/data.length+(realWidth-hStep-hStep2-gap*(1+Math.sqrt(series)))/data.length/2;var xLabelSpace=computeXLabelSpace(labels[i]);if(labelOrientation=="vertical"){c.save();c.translate(middleX-c.measureText(labels[i]).width/2,realHeight-step/2-xLegendSpace/2);c.rotate(-Math.PI/2);c.textAlign="center";c.fillText(labels[i],0,c.measureText(labels[i]).width/2+6);c.restore()}else{if(labelOrientation=="diagonal"){c.save();c.translate(middleX-(c.measureText(labels[i]).width/2)*Math.cos(Math.PI/4),realHeight-step+(c.measureText(labels[i]).width/2)*Math.sin(Math.PI/4));c.rotate(-Math.PI/4);c.textAlign="center";c.fillText(labels[i],0,16);c.restore()}else{if(labelOrientation=="halfdiagonal"){c.save();c.translate(middleX-(c.measureText(labels[i]).width/2)*Math.cos(Math.PI/8),realHeight-step+(c.measureText(labels[i]).width/2)*Math.sin(Math.PI/8));c.rotate(-Math.PI/8);c.textAlign="center";c.fillText(labels[i],0,16);c.restore()}else{c.fillText(labels[i],middleX-c.measureText(labels[i]).width/2,realHeight-step/2-xLegendSpace/4)}}}}c.font=font}}function drawGrid(){if(showGridY){for(var i=0;i<tickCount+1;i++){var xColor=c.strokeStyle;if(obj.colorGridY!=="undefined"){c.strokeStyle=obj.colorGridY}c.lineWidth=0.2;c.beginPath();c.moveTo(hStep-10,i*tickStep+tickInit+titleSpace+legendSpace);var diff=10;if(obj.dualYaxis){diff=hStep2}c.lineTo(realWidth-diff,i*tickStep+tickInit+titleSpace+legendSpace);c.closePath();c.stroke();c.lineWidth=2;c.strokeStyle=xColor}}if(showGridX){for(var i=0;i<labels.length;i++){var middleX=hStep+i*(realWidth-hStep-hStep2)/data.length+(realWidth-hStep-hStep2-gap*(1+Math.sqrt(series)))/data.length/2;var yColor=c.strokeStyle;if(obj.colorGridX!=="undefined"){c.strokeStyle=obj.colorGridX}c.lineWidth=0.2;c.beginPath();c.moveTo(middleX,10+titleSpace+legendSpace);c.lineTo(middleX,realHeight-step);c.closePath();c.stroke();c.lineWidth=2;c.strokeStyle=yColor}}}function drawAxis(){c.fillStyle="black";c.lineWidth=2;var axisColor=c.strokeStyle;if(obj.colorYaxis!=="undefined"){c.strokeStyle=obj.colorYaxis}c.beginPath();c.moveTo(hStep-10,titleSpace+legendSpace);c.lineTo(hStep-10,realHeight-step);c.closePath();c.stroke();if(obj.colorXaxis!=="undefined"){c.strokeStyle=obj.colorXaxis}c.beginPath();c.moveTo(hStep-10,realHeight-step);var diff=5;if(obj.dualYaxis){diff=hStep2-5}c.lineTo(realWidth-diff,realHeight-step);c.closePath();c.stroke();if(obj.dualYaxis){if(obj.colorY2axis!=="undefined"){c.strokeStyle=obj.colorY2axis}c.beginPath();c.moveTo(realWidth-hStep2,titleSpace+legendSpace);c.lineTo(realWidth-hStep2,realHeight-step);c.closePath();c.stroke()}c.strokeStyle=axisColor}function getTooltip(mousePos){return drawData(false,false,mousePos)}function onClick(evt){var v=drawData(false,true,getMousePos(canvas,evt));if((v!=="")&&(obj.onClick!==undefined)){var f=obj.onClick;eval(f);doClick(v)}return v}function drawChart(){window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){window.setTimeout(callback,1000/60)}})();window.requestAnimFrame(animDraw)}function computeHStep(maxValY,yStep,takeCare){var result;var font=c.font;if(showTicks){var maxLabelWidth=0;if(typeof obj.yData!=="undefined"){var yfont=obj.yData.font;if(adjustableTextFontSize){yfont.size=getAdjustableLabelFontSize()}var b=" ";c.font=yfont.weight+b+yfont.size+"px"+b+yfont.family}for(var i=0;i<tickCount+1;i++){var label=Math.round((maxValY-i*yStep)*100)/100;var labelWidth=c.measureText(label).width;if(labelWidth>maxLabelWidth){maxLabelWidth=labelWidth}}result=maxLabelWidth+20}else{result=20}c.font=font;if(obj.dualYaxis&&!takeCare){if(typeof obj.y2Legend!=="undefined"){var b=" ";var f=obj.y2Legend.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;y2LegendSpace=f.size;c.font=font;result+=y2LegendSpace}}if(takeCare){if(typeof obj.yLegend!=="undefined"){var b=" ";var f=obj.yLegend.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()}yLegendSpace=+legendPadding+ +f.size;c.font=font;result+=yLegendSpace}var cf=c.font;if(obj.xData!==undefined){var b=" ";var xfont=obj.xData.font;if(adjustableTextFontSize){xfont.size=getAdjustableLabelFontSize()}c.font=xfont.weight+b+xfont.size+"px"+b+xfont.family}var minPos=new Array();for(var i=0;i<labels.length;i++){realWidth=canvas.width;var middleX=result+i*(realWidth-result)/data.length+(realWidth-result-gap*(1+Math.sqrt(series)))/data.length/2;var angle;if(labelOrientation=="diagonal"){angle=Math.PI/4}else{if(labelOrientation=="halfdiagonal"){angle=Math.PI/8}}if(angle!==undefined){var len=middleX-c.measureText(labels[i]).width*Math.cos(angle);minPos.push(len)}}var len=Math.min.apply(Math,minPos);if(minPos.length>0){if(len<10){result+=(10-len)}}}return result}function computeVStep(){var xLabelWidth=0;if(typeof obj.xData!=="undefined"){var xfont=obj.xData.font;if(adjustableTextFontSize){xfont.size=getAdjustableLabelFontSize()}var b=" ";c.font=xfont.weight+b+xfont.size+"px"+b+xfont.family}if(showLabels){for(var i=0;i<labels.length;i++){var labelWidth=computeXLabelSpace(labels[i]);if(labelWidth>xLabelWidth){xLabelWidth=labelWidth}}}var _xLegendSpace=0;if(typeof obj.xLegend!=="undefined"){var f=obj.xLegend.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize()}var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()}_xLegendSpace=+legendPadding+ +f.size}if((step<xLabelWidth+_xLegendSpace)||adjustableTextFontSize){step=xLabelWidth+_xLegendSpace}return xLabelWidth}function computeXLabelSpace(label){var _labelWidth=c.measureText(label).width+10;if(labelOrientation==="horizontal"){if(typeof obj.xData!=="undefined"){_labelWidth=obj.xData.font.size+20;if(adjustableTextFontSize){_labelWidth=getAdjustableLabelFontSize()+20}}else{_labelWidth=12+20}}else{if(labelOrientation==="halfdiagonal"){_labelWidth=c.measureText(label).width*Math.sin(Math.PI/8)+20}else{if(labelOrientation==="diagonal"){_labelWidth=c.measureText(label).width*Math.sin(Math.PI/4)+20}}}return _labelWidth}function getTitleSpace(){var space=10;if(typeof obj.title!=="undefined"){var f=obj.title.font;if(f===undefined){f.size=12}if(adjustableTextFontSize){f.size=getAdjustableTitleFontSize()}var titlePadding=20;if(adjustableTextFontSize){titlePadding=getAdjustableTitleFontSize()}space=+titlePadding+ +f.size}return space}function getXLegendSpace(){var _xLegendSpace=0;if(typeof obj.xLegend!=="undefined"){var f=obj.xLegend.font;if(f===undefined){f.size=12}var legendPadding=20;if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize();legendPadding=getAdjustableLabelFontSize()}_xLegendSpace=+legendPadding+ +f.size}return _xLegendSpace}function getLegendSpace(){var font=c.font;var _legendSpace=20;if(typeof obj.legend!=="undefined"){var x=hStep;c.font="bold 10px sans-serif";if(adjustableTextFontSize){c.font="bold "+getAdjustableLabelFontSize()+"px sans-serif"}var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()/2}var legendY=getTitleSpace()+legendPadding;for(var k=0;k<series;k++){var legendWidth=c.measureText(obj.legend[k]).width+24;if(x+legendWidth>realWidth){x=hStep;var lineSpace=14;if(adjustableTextFontSize){lineSpace=getAdjustableLabelFontSize()}legendY=legendY+lineSpace;var pad=20;if(adjustableTextFontSize){pad=getAdjustableLabelFontSize()}_legendSpace+=pad}x=x+legendWidth}}c.font=font;return _legendSpace}function resizeCanvas(){var can=document.getElementById(idCan);if(can!=null){var w=canWidth;if(resizeWidth){if(!isPercent(w)){w="100%"}}var h=canHeight;if(resizeHeight){if(!isPercent(h)){h="100%"}}updateSize(w,h);drawChart()}}function getAdjustableTitleFontSize(){return canvas.width/25}function getAdjustableLabelFontSize(){return canvas.width/45}drawLine(myjson,idCan,idTipCan,canWidth,canHeight)};function getLineY(a,d,e,c){var f,b;if(a==d){f=a;b=d}else{if(a>d){f=a-c*Math.sin(e);b=d+c*Math.sin(e)}else{if(a<d){f=a+c*Math.sin(e);b=d-c*Math.sin(e)}}}return{y:f,y2:b}}function drawDot(g,d,b,a,e,f){g.beginPath();g.arc(b,a,e,0,Math.PI*2,true);if(f){if(d=="hollowdot"){g.stroke()}else{g.fill()}}}function drawBow(g,b,a,e){var f=4;g.beginPath();g.moveTo(b,a);g.lineTo(b-f,a-f);g.lineTo(b+f,a-f);g.lineTo(b-f,a+f);g.lineTo(b+f,a+f);g.lineTo(b,a);if(e){g.stroke()}}function drawAnchor(g,b,a,e){var f=8;g.beginPath();g.moveTo(b-f/2,a+Math.sqrt(3)*f/6);g.lineTo(b,a-2*Math.sqrt(3)*f/6);g.lineTo(b+f/2,a+Math.sqrt(3)*f/6);g.lineTo(b-f/2,a+Math.sqrt(3)*f/6);if(e){g.stroke()}}function drawStar(j,b,h,e,g,a,f){j.save();j.beginPath();j.translate(b,h);j.moveTo(0,0-e);for(var d=0;d<g;d++){j.rotate(Math.PI/g);j.lineTo(0,0-(e*a));j.rotate(Math.PI/g);j.lineTo(0,0-e)}if(f){j.stroke()}j.restore()}function drawLineElements(v,z,g,d,b,A,h,s,r,p,q,w,u,f,o,l){var t=d+2;var j,a,e;if(q<h-1){e=Math.atan(Math.abs(o-u)/Math.abs(f-w))}var m=getLineY(u,o,e,t);v.strokeStyle=b[p];v.fillStyle=b[p];if(q<h-1){v.beginPath();v.moveTo(w+t*Math.cos(e),m.y);v.lineTo(f-t*Math.cos(e),m.y2)}else{if(g=="area"){v.strokeStyle=colorLuminance(b[p],1.3);v.beginPath();for(var q=0;q<A[p].length;q++){var n=A[p][q];if(q==0){v.moveTo(n.x,n.y)}else{v.lineTo(n.x,n.y)}}v.lineTo(w,s);v.lineTo(A[p][0].x,s);v.lineTo(A[p][0].x,A[p][0].y);v.closePath();if(l){v.globalAlpha=r;v.fill();v.globalAlpha=1}}}if(l){if(w!=f){v.lineWidth=2;v.stroke()}}v.lineWidth=1;if((z=="normal")||(z=="soliddot")||(z=="hollowdot")){drawDot(v,z,w,u,d,l)}else{if(z=="bowdot"){drawBow(v,w,u,l)}else{if(z=="anchordot"){drawAnchor(v,w,u,l)}else{if(z=="stardot"){drawStar(v,w,u,5,5,0.5,l)}}}}}var pieChart=function(myjson,idCan,idTipCan,canWidth,canHeight){var obj;var data;var labels;var globalAlpha;var showLabels;var background;var message;var chartType;var seriesColor;var titleSpace=0;var realWidth;var realHeight;var canvas;var c;var tipCanvas;var H=6;var line=20;var hline=5;var resizeWidth=false;var resizeHeight=false;var delta=0;var adjustableTextFontSize=false;function drawPie(myjson,idCan,idTipCan,canWidth,canHeight){canvas=document.getElementById(idCan);if(canvas==null){return}tipCanvas=document.getElementById(idTipCan);c=canvas.getContext("2d");obj=myjson;chartType=obj.type;if(typeof chartType==="undefined"){chartType="pie"}background=obj.background;if(typeof background==="undefined"){background="white"}data=obj.data[0];for(var i=0;i<data.length;i++){if(data[i]<0){data[i]=0}}labels=obj.labels;globalAlpha=obj.alpha;if(typeof globalAlpha==="undefined"){globalAlpha=0.8}showLabels=obj.showLabels;if(typeof showLabels==="undefined"){showLabels=true}message=obj.message;if(typeof message==="undefined"){message="#val / #total<br>#percent% of 100%"}adjustableTextFontSize=obj.adjustableTextFontSize;if(typeof adjustableTextFontSize==="undefined"){adjustableTextFontSize=false}seriesColor=obj.color;if(typeof seriesColor==="undefined"){seriesColor=distinctHexColors(data.length)}if(seriesColor.length<data.length){seriesColor=seriesColor.concat(distinctHexColors(data.length-seriesColor.length))}updateSize(canWidth,canHeight);canvas.addEventListener("mousemove",function(evt){var hme=Object.create(handleMouseEvent);hme.mousePos=getMousePos(canvas,evt);hme.tooltip=getTooltip(hme.mousePos);hme.execute(canvas,tipCanvas,evt)},false);canvas.addEventListener("mouseout",function(evt){tipCanvas.style.left="-2000px"},false);canvas.addEventListener("click",onClick,false);if(resizeWidth||resizeHeight){window.addEventListener("resize",resizeCanvas,false)}drawChart()}function updateSize(canWidth,canHeight){if(canWidth!==undefined){if(isPercent(canWidth)){var percent=canWidth.substring(0,canWidth.length-1);var cl=canvas.parentNode;canvas.width=cl.offsetWidth*percent/100;resizeWidth=true}else{canvas.width=canWidth}}if(canHeight!==undefined){if(isPercent(canHeight)){var percent=canHeight.substring(0,canHeight.length-1);canvas.height=window.innerHeight*percent/100;resizeHeight=true}else{canvas.height=canHeight}}realWidth=canvas.width;realHeight=canvas.height}function animDraw(){if(drawIt(H)){return false}H+=1+(realHeight-titleSpace)/30;window.requestAnimFrame(animDraw)}function drawIt(H){drawInit();var stop=drawData(true,false,"");return stop}function drawData(withFill,withClick,mousePos){var font=c.font;c.lineWidth=1;var stop=true;var pieData=[];var cx;var cy;if(showLabels){cx=realWidth-2*getMaxLabelWidth()-2*line-20;cy=realHeight-titleSpace-getLabelHeight()-2*line-20}else{cx=realWidth-2*line-20;cy=realHeight-titleSpace-2*line-20}var center=[realWidth/2,(realHeight+titleSpace)/2];var radius=Math.min(cx,cy)/2;if(radius<0){radius=20}var total=0;var lastPosition=0;for(var i in data){total+=data[i]}if(radius-delta<H){H=radius-delta}else{stop=false}for(var i in data){pieData[i]=[];pieData[i]["value"]=data[i];var percent=data[i]*100/total;pieData[i]["percent"]=Math.round(percent*100)/100;pieData[i]["startAngle"]=2*Math.PI*lastPosition;pieData[i]["endAngle"]=2*Math.PI*(lastPosition+(data[i]/total));pieData[i]["labelAngle"]=pieData[i]["startAngle"]+Math.abs(pieData[i]["endAngle"]-pieData[i]["startAngle"])/2;pieData[i]["middle"]=[center[0]+H*Math.cos(pieData[i]["labelAngle"]),center[1]+H*Math.sin(pieData[i]["labelAngle"])];pieData[i]["labelpos"]=[pieData[i]["middle"][0]+line*Math.cos(pieData[i]["labelAngle"]),pieData[i]["middle"][1]+line*Math.sin(pieData[i]["labelAngle"])];lastPosition+=data[i]/total}delta=adjustYLabels(pieData,center,H+line);for(var i=0;i<data.length;i++){if(withFill){var gradient=c.createLinearGradient(0,0,realWidth,realHeight);gradient.addColorStop(0,"#ddd");gradient.addColorStop(1,seriesColor[i]);c.beginPath();if(pieData.length>1){c.moveTo(center[0],center[1])}c.arc(center[0],center[1],H,pieData[i]["startAngle"],pieData[i]["endAngle"],false);if(pieData.length>1){c.lineTo(center[0],center[1])}c.closePath();c.fillStyle=gradient;c.fill();c.lineWidth=1;c.strokeStyle="#fff";c.stroke();if(typeof labels!=="undefined"){drawLabels(i,pieData)}}else{var fromCenterX=mousePos.x-center[0];var fromCenterY=mousePos.y-center[1];var fromCenter=Math.sqrt(Math.pow(Math.abs(fromCenterX),2)+Math.pow(Math.abs(fromCenterY),2));if(fromCenter<=radius-delta){var angle=Math.atan2(fromCenterY,fromCenterX);if(angle<0){angle=2*Math.PI+angle}for(var slice in pieData){if(angle>=pieData[slice]["startAngle"]&&angle<=pieData[slice]["endAngle"]){var tValue=pieData[slice]["value"];var tTotal=total;if(obj.tooltipPattern!==undefined){tValue=formatNumber(tValue,obj.tooltipPattern.decimals,obj.tooltipPattern.decimalSeparator,obj.tooltipPattern.thousandSeparator);tTotal=formatNumber(tTotal,obj.tooltipPattern.decimals,obj.tooltipPattern.decimalSeparator,obj.tooltipPattern.thousandSeparator)}var returnValue;if(labels===undefined){returnValue=""}else{returnValue=labels[slice]}if(withClick){return returnValue}else{var mes=String(message).replace("#val",tValue);mes=mes.replace("#x",returnValue);mes=mes.replace("#total",tTotal);mes=mes.replace("#percent",pieData[slice]["percent"]);if(obj.onClick!==undefined){canvas.style.cursor="pointer"}return mes}}else{canvas.style.cursor="default"}}}}}if(withFill){return stop}else{return""}}function drawLabels(i,pieData){if(showLabels){var x=pieData[i]["middle"][0];var y=pieData[i]["middle"][1];var x1=pieData[i]["labelpos"][0];var y1=pieData[i]["labelpos"][1];c.beginPath();c.moveTo(x,y);c.lineTo(x1,y1);var writeFrom=true;if((pieData[i]["labelAngle"]==Math.PI)||(pieData[i]["labelAngle"]==2*Math.PI)){if((pieData[i]["labelAngle"]==Math.PI)||(pieData.length==1)){writeFrom=false}}else{if(pieData[i]["labelAngle"]<=Math.PI/2){x1=x1+hline}else{if(pieData[i]["labelAngle"]<Math.PI){x1=x1-hline;writeFrom=false}else{if(pieData[i]["labelAngle"]<=3*Math.PI/2){x1=x1-hline;writeFrom=false}else{if(pieData[i]["labelAngle"]<2*Math.PI){x1=x1+hline}}}}}c.lineTo(x1,y1);c.strokeStyle=seriesColor[i];c.stroke();c.fillStyle=seriesColor[i];var fontHeight=12;if(obj.xData!==undefined){var b=" ";var xfont=obj.xData.font;fontHeight=xfont.size;if(adjustableTextFontSize){fontHeight=getAdjustableTitleFontSize();xfont.size=fontHeight}c.font=xfont.weight+b+xfont.size+"px"+b+xfont.family}else{var fs=12;if(adjustableTextFontSize){fs=getAdjustableTitleFontSize()}c.font="bold "+fs+"px sans-serif"}if(writeFrom){c.fillText(labels[i],x1+5,y1+fontHeight/2)}else{var size=c.measureText(labels[i]).width+5;c.fillText(labels[i],x1-size,y1+fontHeight/2)}}}function drawInit(){var font=c.font;c.fillStyle=background;c.fillRect(0,0,realWidth,realHeight);if(typeof obj.title!=="undefined"){var titleColor=obj.title.color;if(titleColor===undefined){titleColor="#000000"}c.fillStyle=titleColor;var b=" ";var f=obj.title.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableTitleFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;var titlePadding=20;if(adjustableTextFontSize){titlePadding=getAdjustableTitleFontSize()/2}titleSpace=+titlePadding+ +f.size;var alignment=obj.title.alignment;if(alignment===undefined){alignment="center"}var xTitle;if(alignment=="left"){xTitle=10}else{if(alignment=="right"){xTitle=canvas.width-c.measureText(obj.title.text).width-10}else{xTitle=canvas.width/2-c.measureText(obj.title.text).width/2}}var titlePadding=20;if(adjustableTextFontSize){titlePadding=getAdjustableTitleFontSize()/2}c.fillText(obj.title.text,xTitle,titlePadding+titleSpace/2);c.font=font}else{titleSpace=0}c.font=font}function getTooltip(mousePos){return drawData(false,false,mousePos)}function onClick(evt){var v=drawData(false,true,getMousePos(canvas,evt));if((v!=="")&&(obj.onClick!==undefined)){var f=obj.onClick;eval(f);doClick(v)}return v}function drawChart(){window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){window.setTimeout(callback,1000/60)}})();window.requestAnimFrame(animDraw)}function getTitleSpace(){var space=0;if(typeof obj.title!=="undefined"){var f=obj.title.font;if(f===undefined){f.size=12}if(adjustableTextFontSize){f.size=getAdjustableTitleFontSize()}var titlePadding=20;if(adjustableTextFontSize){titlePadding=getAdjustableTitleFontSize()}space=+titlePadding+ +f.size}return space}function getLabelHeight(){var fontHeight=12;if(obj.xData!==undefined){fontHeight=obj.xData.font.size}if(adjustableTextFontSize){fontHeight=getAdjustableTitleFontSize()}return fontHeight}function getMaxLabelWidth(){if(typeof labels==="undefined"){return 0}var font=c.font;var max=0;if(obj.xData!==undefined){var b=" ";var xfont=obj.xData.font;if(adjustableTextFontSize){xfont.size=getAdjustableTitleFontSize()}c.font=xfont.weight+b+xfont.size+"px"+b+xfont.family}else{var fs=12;if(adjustableTextFontSize){fs=getAdjustableTitleFontSize()}c.font="bold "+fs+"px sans-serif"}for(var i=0;i<labels.length;i++){var size=c.measureText(labels[i]).width+5;if(size>max){max=size}}c.font=font;return max}function adjustYLabels(pieData,center,R){var f=getFontHeight();var d=0;for(var i=1;i<pieData.length;i++){var y1=pieData[i-1]["labelpos"][1];var y2=pieData[i]["labelpos"][1];if(isRightCadran(i,pieData)&&isRightCadran(i-1,pieData)){if(((y1<=y2)&&(y1+f/2>y2-f/2))||(y1>y2)){pieData[i]["labelpos"][1]=y1+f/2+5;var m=Math.pow(R,2)-Math.pow(pieData[i]["labelpos"][1]-center[1],2);if(m>0){pieData[i]["labelpos"][0]=center[0]+Math.sqrt(m)}else{pieData[i]["labelpos"][0]=center[0]-Math.sqrt(-m)}if(pieData[i]["labelpos"][1]>realHeight-titleSpace){d+=f}}}else{if(!isRightCadran(i,pieData)&&!isRightCadran(i-1,pieData)){if(((y1>=y2)&&(y1-f/2<y2+f/2))||(y1<y2)){pieData[i]["labelpos"][1]=y1-f/2-5;var m=Math.pow(R,2)-Math.pow(pieData[i]["labelpos"][1]-center[1],2);if(m>0){pieData[i]["labelpos"][0]=center[0]-Math.sqrt(m)}else{if(pieData[i]["labelAngle"]>3*Math.PI/2){pieData[i]["labelpos"][0]=center[0]+Math.sqrt(-m)}}if(pieData[i]["labelpos"][1]<titleSpace+f){d+=f}}}}}return d}function resizeCanvas(){var can=document.getElementById(idCan);if(can!=null){var w=canWidth;if(resizeWidth){if(!isPercent(w)){w="100%"}}var h=canHeight;if(resizeHeight){if(!isPercent(h)){h="100%"}}updateSize(w,h);drawChart()}}function getFontHeight(){var fontHeight=12;if(obj.xData!==undefined){var xfont=obj.xData.font;fontHeight=xfont.size}if(adjustableTextFontSize){fontHeight=getAdjustableTitleFontSize()}return fontHeight}function isRightCadran(i,pieData){var yes=true;if(pieData[i]["labelAngle"]<=Math.PI/2){yes=true}else{if(pieData[i]["labelAngle"]<=3*Math.PI/2){yes=false}else{if(pieData[i]["labelAngle"]<=2*Math.PI){yes=true}}}return yes}function getAdjustableTitleFontSize(){return canvas.width/25}function getAdjustableLabelFontSize(){return canvas.width/45}drawPie(myjson,idCan,idTipCan,canWidth,canHeight)};var bubbleChart=function(myjson,idCan,idTipCan,canWidth,canHeight){var obj;var data;var labels=new Array();var labelOrientation;var globalAlpha;var showGridX;var showGridY;var showLabels;var background;var message;var tickCount;var showTicks;var startingFromZero;var chartType;var chartStyle;var seriesColor;var xData,yData;var series;var uniqueCategories=new Array();var yStep;var dotsK=new Array();var max;var min;var tickStep;var minValY;var maxValY;var step=0;var gap=40;var hStep=60;var titleSpace=0;var legendSpace=0;var xLegendSpace=0;var yLegendSpace=0;var xaxisY=0;var realWidth;var realHeight;var canvas;var c;var tipCanvas;var H=new Array();var dotRadius=3;var tickInit;var resizeWidth=false;var resizeHeight=false;var adjustableTextFontSize=false;function drawBubble(myjson,idCan,idTipCan,canWidth,canHeight){canvas=document.getElementById(idCan);if(canvas==null){return}tipCanvas=document.getElementById(idTipCan);c=canvas.getContext("2d");obj=myjson;chartType=obj.type;if(typeof chartType==="undefined"){chartType="bubble"}background=obj.background;if(typeof background==="undefined"){background="white"}chartStyle=obj.style;if((typeof chartStyle==="undefined")||(find(["normal","glass"],chartStyle)===false)){chartStyle="normal"}data=obj.data[0];for(var i=0;i<obj.categories.length;i++){var cat=obj.categories[i];if(find(uniqueCategories,cat)===false){uniqueCategories.push(cat)}H.push(6)}obj.legend=uniqueCategories;series=uniqueCategories.length;labelOrientation=obj.labelOrientation;if(typeof labelOrientation==="undefined"){labelOrientation="horizontal"}globalAlpha=obj.alpha;if(typeof globalAlpha==="undefined"){globalAlpha=0.8}showTicks=obj.showTicks;if(typeof showTicks==="undefined"){showTicks=true}startingFromZero=obj.startingFromZero;if(typeof startingFromZero==="undefined"){startingFromZero=false}showGridX=obj.showGridX;if(typeof showGridX==="undefined"){showGridX=true}showGridY=obj.showGridY;if(typeof showGridY==="undefined"){showGridY=true}showLabels=obj.showLabels;if(typeof showLabels==="undefined"){showLabels=true}message=obj.message;if(typeof message==="undefined"){message="#label<br>X: #x<br>Y: #val<br>Z: #z<br>Series: #c"}adjustableTextFontSize=obj.adjustableTextFontSize;if(typeof adjustableTextFontSize==="undefined"){adjustableTextFontSize=false}tickCount=obj.tickCount;if(typeof tickCount==="undefined"){tickCount=5}seriesColor=obj.color;if(typeof seriesColor==="undefined"){seriesColor=distinctHexColors(series)}max=Math.max.apply(Math,obj.data[1]);min=Math.min.apply(Math,obj.data[1]);if(startingFromZero&&(min>0)){min=0}var objStep=calculateYStep(min,max,tickCount);yStep=objStep.yStep;minValY=objStep.minValY;maxValY=objStep.maxValY;var xmax=Math.max.apply(Math,obj.data[0]);var xmin=Math.min.apply(Math,obj.data[0]);var xobjStep=calculateYStep(xmin,xmax,tickCount);var x_yStep=xobjStep.yStep;var minValX=xobjStep.minValY;var maxValX=xobjStep.maxValY;for(var i=0;i<tickCount+1;i++){var label;if(obj.tooltipPattern!==undefined){var decimals=obj.tooltipPattern.decimals;var exp=Math.pow(10,decimals);label=Math.round((maxValX-i*x_yStep)*exp)/exp}else{label=Math.round((maxValX-i*x_yStep)*100)/100}labels.unshift(label)}hStep=computeHStep();updateSize(canWidth,canHeight);canvas.addEventListener("mousemove",function(evt){var hme=Object.create(handleMouseEvent);hme.mousePos=getMousePos(canvas,evt);hme.tooltip=getTooltip(hme.mousePos);hme.execute(canvas,tipCanvas,evt)},false);canvas.addEventListener("mouseout",function(evt){tipCanvas.style.left="-2000px"},false);canvas.addEventListener("click",onClick,false);if(resizeWidth||resizeHeight){window.addEventListener("resize",resizeCanvas,false)}drawChart()}function updateSize(canWidth,canHeight){if(canWidth!==undefined){if(isPercent(canWidth)){var percent=canWidth.substring(0,canWidth.length-1);var cl=canvas.parentNode;canvas.width=cl.offsetWidth*percent/100;resizeWidth=true}else{canvas.width=canWidth}}if(canHeight!==undefined){if(isPercent(canHeight)){var percent=canHeight.substring(0,canHeight.length-1);canvas.height=window.innerHeight*percent/100;resizeHeight=true}else{canvas.height=canHeight}}realWidth=canvas.width;realHeight=canvas.height;gap=realWidth/10-10;tickInit=realHeight/12;tickStep=(realHeight-step-tickInit)/tickCount;if(adjustableTextFontSize){var objStep=calculateYStep(min,max,tickCount);yStep=objStep.yStep;minValY=objStep.minValY;maxValY=objStep.maxValY;hStep=computeHStep(maxValY,yStep,true)}}function animDraw(){if(drawIt(H)){return false}for(var i=0;i<obj.categories.length;i++){H[i]+=1+(realHeight-step-titleSpace-legendSpace)/30}window.requestAnimFrame(animDraw)}function drawIt(H){drawInit();var stop=drawData(true,false,"");drawGrid();drawAxis();return stop}function drawData(withFill,withClick,mousePos){var font=c.font;c.lineWidth=1;var stop=true;var lx0=hStep+(realWidth-hStep-gap*2)/labels.length/2;var lxn=hStep+((labels.length-1)*(realWidth-hStep)/labels.length)+(realWidth-hStep-gap*2)/labels.length/2;var mx=(labels[labels.length-1]-labels[0])/(lxn-lx0);var nx=(labels[0]*lxn-labels[1]*lx0)/(lxn-lx0);var ly0=tickInit+titleSpace+legendSpace;var lyn=tickCount*tickStep+tickInit+titleSpace+legendSpace;var y0=getYValue(0,maxValY,yStep);var yn=getYValue(tickCount,maxValY,yStep);var my=(yn-y0)/(lyn-ly0);var ny=(y0*lyn-yn*ly0)/(lyn-ly0);var maxRadius=tickStep*tickCount/4;var maxZ=Math.max.apply(Math,obj.data[2]);var radius=new Array();for(var i=0;i<data.length;i++){var dataX=hStep+(obj.data[0][i]-nx)/mx+gap/2-c.measureText("0").width/2-yLegendSpace/4;var dataY=(obj.data[1][i]-ny)/my;radius[i]=obj.data[2][i]*(maxRadius/maxZ)*2/Math.PI+4;if(radius[i]<3){radius[i]=3}if(radius[i]<H[i]){H[i]=radius[i];var test=false;for(var j=0;j<data.length;j++){if(radius[j]>=H[j]){test=true}}if(test){stop=false}}else{stop=false}var sColor=getSeriesColor(i);c.strokeStyle=sColor;if(chartStyle=="glass"){var gradient=c.createLinearGradient(dataX-2*H[i],dataY-2*H[i],4*H[i],4*H[i]);gradient.addColorStop(0,"#ddd");gradient.addColorStop(1,sColor);c.fillStyle=gradient}else{c.fillStyle=sColor}c.beginPath();c.arc(dataX,dataY,H[i],0,Math.PI*2);if(withFill){c.globalAlpha=globalAlpha;c.fill();c.globalAlpha=1;var oldStroke=c.strokeStyle;c.strokeStyle="#fff";c.stroke();c.strokeStyle=oldStroke}else{if(c.isPointInPath(mousePos.x,mousePos.y)){var tValue=obj.data[1][i];if(obj.tooltipPattern!==undefined){tValue=formatNumber(tValue,obj.tooltipPattern.decimals,obj.tooltipPattern.decimalSeparator,obj.tooltipPattern.thousandSeparator)}var returnValue=obj.data[0][i];if(withClick){return returnValue}else{var mes=String(message).replace("#val",tValue);mes=mes.replace("#x",returnValue);mes=mes.replace("#z",obj.data[2][i]);mes=mes.replace("#c",obj.categories[i]);mes=mes.replace("#label",obj.labels[i]);if(obj.onClick!==undefined){canvas.style.cursor="pointer"}return mes}}else{canvas.style.cursor="default"}}}if(withFill){return stop}else{return""}}function getYValue(i,maxValY,yStep){var label;if(obj.tooltipPattern!==undefined){var decimals=obj.tooltipPattern.decimals;var exp=Math.pow(10,decimals);label=Math.round((maxValY-i*yStep)*exp)/exp}else{label=Math.round((maxValY-i*yStep)*100)/100}return label}function getSeriesColor(i){var cat=obj.categories[i];var ind=find(uniqueCategories,cat);if(ind===false){return"white"}return seriesColor[ind]}function drawInit(){var font=c.font;c.fillStyle=background;c.fillRect(0,0,realWidth,realHeight);var xLabelWidth=computeVStep();if(typeof obj.title!=="undefined"){var titleColor=obj.title.color;if(titleColor===undefined){titleColor="#000000"}c.fillStyle=titleColor;var b=" ";var f=obj.title.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableTitleFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;var titlePadding=20;if(adjustableTextFontSize){titlePadding=getAdjustableTitleFontSize()/2}titleSpace=+titlePadding+ +f.size;var alignment=obj.title.alignment;if(alignment===undefined){alignment="center"}var xTitle;if(alignment=="left"){xTitle=hStep}else{if(alignment=="right"){xTitle=canvas.width-c.measureText(obj.title.text).width-10}else{xTitle=canvas.width/2-c.measureText(obj.title.text).width/2}}var titlePadding=20;if(adjustableTextFontSize){titlePadding=getAdjustableTitleFontSize()/2}c.fillText(obj.title.text,xTitle,titlePadding+titleSpace/2);c.font=font}else{titleSpace=10}if(typeof obj.xLegend!=="undefined"){var xLegendColor=obj.xLegend.color;if(xLegendColor===undefined){xLegendColor="#000000"}c.fillStyle=xLegendColor;var b=" ";var f=obj.xLegend.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()/2}xLegendSpace=+legendPadding+ +f.size;c.fillText(obj.xLegend.text,realWidth/2-c.measureText(obj.xLegend.text).width/2,realHeight-f.size);c.font=font}else{xLegendSpace=0}if(typeof obj.yLegend!=="undefined"){var yLegendColor=obj.yLegend.color;if(yLegendColor===undefined){yLegendColor="#000000"}var b=" ";var f=obj.yLegend.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;c.fillStyle=yLegendColor;c.save();c.translate(10,realHeight/2);c.rotate(-Math.PI/2);c.textAlign="center";c.fillText(obj.yLegend.text,0,f.size);c.restore();c.font=font}else{yLegendSpace=0}if(typeof obj.legend!=="undefined"){var x=hStep;c.font="bold 10px sans-serif";if(adjustableTextFontSize){c.font="bold "+getAdjustableLabelFontSize()+"px sans-serif"}var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()}legendSpace=legendPadding;var legendY=titleSpace+legendPadding;c.globalAlpha=globalAlpha;for(var k=0;k<series;k++){c.fillStyle=seriesColor[k];var legendWidth=c.measureText("---- "+obj.legend[k]).width+24;if(x+legendWidth>realWidth){x=hStep;var lineSpace=14;if(adjustableTextFontSize){lineSpace=getAdjustableLabelFontSize()}legendY=legendY+lineSpace;var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()}legendSpace+=legendPadding}c.fillText("---- "+obj.legend[k],x,legendY);x=x+legendWidth}c.globalAlpha=1;c.font=font}c.font=font;tickStep=(realHeight-step-titleSpace-legendSpace-tickInit)/tickCount;xaxisY=tickCount*tickStep+tickInit+titleSpace+legendSpace;drawLabels(xLabelWidth)}function drawLabels(xLabelWidth){var font=c.font;if(showTicks){c.fillStyle="black";if(obj.yData!==undefined){c.fillStyle=obj.yData.color;var b=" ";var yfont=obj.yData.font;if(adjustableTextFontSize){yfont.size=getAdjustableLabelFontSize()}c.font=yfont.weight+b+yfont.size+"px"+b+yfont.family}for(var i=0;i<tickCount+1;i++){var label;if(obj.tooltipPattern!==undefined){var decimals=obj.tooltipPattern.decimals;var exp=Math.pow(10,decimals);label=Math.round((maxValY-i*yStep)*exp)/exp}else{label=Math.round((maxValY-i*yStep)*100)/100}var labelWidth=c.measureText(label).width;c.fillText(label+"",hStep-15-labelWidth,i*tickStep+tickInit+titleSpace+legendSpace);c.lineWidth=2;c.beginPath();c.moveTo(hStep-15,i*tickStep+tickInit+titleSpace+legendSpace);c.lineTo(hStep-10,i*tickStep+tickInit+titleSpace+legendSpace);c.closePath();c.stroke()}c.font=font}if(showLabels){c.fillStyle="black";if(obj.xData!==undefined){c.fillStyle=obj.xData.color;var b=" ";var xfont=obj.xData.font;if(adjustableTextFontSize){xfont.size=getAdjustableLabelFontSize()}c.font=xfont.weight+b+xfont.size+"px"+b+xfont.family}for(var i=0;i<labels.length;i++){var middleX=hStep+i*(realWidth-hStep)/labels.length+(realWidth-hStep-gap*2)/labels.length/2;var xLabelSpace=computeXLabelSpace(labels[i]);if(labelOrientation=="vertical"){c.save();c.translate(middleX-c.measureText(labels[i]).width/2,realHeight-step/2-xLegendSpace/2);c.rotate(-Math.PI/2);c.textAlign="center";c.fillText(labels[i],0,c.measureText(labels[i]).width/2+6);c.restore()}else{if(labelOrientation=="diagonal"){c.save();c.translate(middleX-(c.measureText(labels[i]).width/2)*Math.cos(Math.PI/4),realHeight-step+(c.measureText(labels[i]).width/2)*Math.sin(Math.PI/4));c.rotate(-Math.PI/4);c.textAlign="center";c.fillText(labels[i],0,16);c.restore()}else{if(labelOrientation=="halfdiagonal"){c.save();c.translate(middleX-(c.measureText(labels[i]).width/2)*Math.cos(Math.PI/8),realHeight-step+(c.measureText(labels[i]).width/2)*Math.sin(Math.PI/8));c.rotate(-Math.PI/8);c.textAlign="center";c.fillText(labels[i],0,16);c.restore()}else{c.fillText(labels[i],middleX-c.measureText(labels[i]).width/2,realHeight-step/2-xLegendSpace/4)}}}}c.font=font}}function drawGrid(){if(showGridY){for(var i=0;i<tickCount+1;i++){var xColor=c.strokeStyle;if(obj.colorGridY!=="undefined"){c.strokeStyle=obj.colorGridY}c.lineWidth=0.2;c.beginPath();c.moveTo(hStep-10,i*tickStep+tickInit+titleSpace+legendSpace);c.lineTo(realWidth-10,i*tickStep+tickInit+titleSpace+legendSpace);c.closePath();c.stroke();c.lineWidth=2;c.strokeStyle=xColor}}if(showGridX){for(var i=0;i<labels.length;i++){var middleX=hStep+i*(realWidth-hStep)/labels.length+(realWidth-hStep-gap*2)/labels.length/2;var yColor=c.strokeStyle;if(obj.colorGridX!=="undefined"){c.strokeStyle=obj.colorGridX}c.lineWidth=0.2;c.beginPath();c.moveTo(middleX,10+titleSpace+legendSpace);c.lineTo(middleX,realHeight-step);c.closePath();c.stroke();c.lineWidth=2;c.strokeStyle=yColor}}}function drawAxis(){c.fillStyle="black";c.lineWidth=2;var axisColor=c.strokeStyle;if(obj.colorYaxis!=="undefined"){c.strokeStyle=obj.colorYaxis}c.beginPath();c.moveTo(hStep-10,titleSpace+legendSpace);c.lineTo(hStep-10,realHeight-step);c.closePath();c.stroke();if(obj.colorXaxis!=="undefined"){c.strokeStyle=obj.colorXaxis}c.beginPath();c.moveTo(hStep-10,realHeight-step);c.lineTo(realWidth-5,realHeight-step);c.closePath();c.stroke();c.strokeStyle=axisColor}function getTooltip(mousePos){return drawData(false,false,mousePos)}function onClick(evt){var v=drawData(false,true,getMousePos(canvas,evt));if((v!=="")&&(obj.onClick!==undefined)){var f=obj.onClick;eval(f);doClick(v)}return v}function drawChart(){window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){window.setTimeout(callback,1000/60)}})();window.requestAnimFrame(animDraw)}function computeHStep(){var result;var font=c.font;if(showTicks){var maxLabelWidth=0;if(typeof obj.yData!=="undefined"){var yfont=obj.yData.font;if(adjustableTextFontSize){yfont.size=getAdjustableLabelFontSize()}var b=" ";c.font=yfont.weight+b+yfont.size+"px"+b+yfont.family}for(var i=0;i<tickCount+1;i++){var label=Math.round((maxValY-i*yStep)*100)/100;var labelWidth=c.measureText(label).width;if(labelWidth>maxLabelWidth){maxLabelWidth=labelWidth}}result=maxLabelWidth+20}else{result=20}c.font=font;if(typeof obj.yLegend!=="undefined"){var b=" ";var f=obj.yLegend.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize()}c.font=f.weight+b+f.size+"px"+b+f.family;var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()}yLegendSpace=+legendPadding+ +f.size;c.font=font;result+=yLegendSpace}var cf=c.font;if(obj.xData!==undefined){var b=" ";var xfont=obj.xData.font;if(adjustableTextFontSize){xfont.size=getAdjustableLabelFontSize()}c.font=xfont.weight+b+xfont.size+"px"+b+xfont.family}var minPos=new Array();for(var i=0;i<labels.length;i++){realWidth=canvas.width;var middleX=result+i*(realWidth-result)/data.length+(realWidth-result-gap*(1+Math.sqrt(series)))/data.length/2;var angle;if(labelOrientation=="diagonal"){angle=Math.PI/4}else{if(labelOrientation=="halfdiagonal"){angle=Math.PI/8}}if(angle!==undefined){var len=middleX-c.measureText(labels[i]).width*Math.cos(angle);minPos.push(len)}}var len=Math.min.apply(Math,minPos);if(minPos.length>0){if(len<10){result+=(10-len)}}return result}function computeVStep(){var xLabelWidth=0;if(typeof obj.xData!=="undefined"){var xfont=obj.xData.font;if(adjustableTextFontSize){xfont.size=getAdjustableLabelFontSize()}var b=" ";c.font=xfont.weight+b+xfont.size+"px"+b+xfont.family}if(showLabels){for(var i=0;i<labels.length;i++){var labelWidth=computeXLabelSpace(labels[i]);if(labelWidth>xLabelWidth){xLabelWidth=labelWidth}}}var _xLegendSpace=0;if(typeof obj.xLegend!=="undefined"){var f=obj.xLegend.font;if(f===undefined){f.weight="bold";f.size=12;f.family="sans-serif"}if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize()}var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()}_xLegendSpace=+legendPadding+ +f.size}if((step<xLabelWidth+_xLegendSpace)||adjustableTextFontSize){step=xLabelWidth+_xLegendSpace}return xLabelWidth}function computeXLabelSpace(label){var _labelWidth=c.measureText(label).width+10;if(labelOrientation==="horizontal"){if(typeof obj.xData!=="undefined"){_labelWidth=obj.xData.font.size+20;if(adjustableTextFontSize){_labelWidth=getAdjustableLabelFontSize()+20}}else{_labelWidth=12+20}}else{if(labelOrientation==="halfdiagonal"){_labelWidth=c.measureText(label).width*Math.sin(Math.PI/8)+20}else{if(labelOrientation==="diagonal"){_labelWidth=c.measureText(label).width*Math.sin(Math.PI/4)+20}}}return _labelWidth}function getTitleSpace(){var space=10;if(typeof obj.title!=="undefined"){var f=obj.title.font;if(f===undefined){f.size=12}if(adjustableTextFontSize){f.size=getAdjustableTitleFontSize()}var titlePadding=20;if(adjustableTextFontSize){titlePadding=getAdjustableTitleFontSize()}space=+titlePadding+ +f.size}return space}function getXLegendSpace(){var _xLegendSpace=0;if(typeof obj.xLegend!=="undefined"){var f=obj.xLegend.font;if(f===undefined){f.size=12}var legendPadding=20;if(adjustableTextFontSize){f.size=getAdjustableLabelFontSize();legendPadding=getAdjustableLabelFontSize()}_xLegendSpace=+legendPadding+ +f.size}return _xLegendSpace}function getLegendSpace(){var font=c.font;var _legendSpace=20;if(typeof obj.legend!=="undefined"){var x=hStep;c.font="bold 10px sans-serif";if(adjustableTextFontSize){c.font="bold "+getAdjustableLabelFontSize()+"px sans-serif"}var legendPadding=20;if(adjustableTextFontSize){legendPadding=getAdjustableLabelFontSize()/2}var legendY=getTitleSpace()+legendPadding;for(var k=0;k<series;k++){var legendWidth=c.measureText(obj.legend[k]).width+24;if(x+legendWidth>realWidth){x=hStep;var lineSpace=14;if(adjustableTextFontSize){lineSpace=getAdjustableLabelFontSize()}legendY=legendY+lineSpace;var pad=20;if(adjustableTextFontSize){pad=getAdjustableLabelFontSize()}_legendSpace+=pad}x=x+legendWidth}}c.font=font;return _legendSpace}function resizeCanvas(){var can=document.getElementById(idCan);if(can!=null){var w=canWidth;if(resizeWidth){if(!isPercent(w)){w="100%"}}var h=canHeight;if(resizeHeight){if(!isPercent(h)){h="100%"}}updateSize(w,h);drawChart()}}function getAdjustableTitleFontSize(){return canvas.width/25}function getAdjustableLabelFontSize(){return canvas.width/45}drawBubble(myjson,idCan,idTipCan,canWidth,canHeight)};function nextChart(e,a,b){var d=document.getElementById(a);var c=document.getElementById(b);nextChart(e,a,b,d.width,d.height)}function nextChart(g,a,c,f,e){var b=g.type;if(typeof b==="undefined"){b="line"}if((f==="100%")&&(e==="100%")){var d=document.getElementById(a);d.width=$(window).width();d.height=$(window).height()}if(isBar(b)){barChart(g,a,c,f,e)}else{if(isPie(b)){pieChart(g,a,c,f,e)}else{if(isBubble(b)){bubbleChart(g,a,c,f,e)}else{lineChart(g,a,c,f,e)}}}}function isBar(a){return(a=="bar")||(a=="hbar")||(a=="stackedbar")||(a=="hstackedbar")}function isLine(a){return(a=="line")||(a=="area")}function isPie(a){return(a=="pie")}function isBubble(a){return(a=="bubble")}function data(c,d,b,a,e){this.size=c;this.radix=d;this.arcWidth=b;this.x=a;this.y=e}var getData=function(c,j,b){var l=document.getElementById(c);var k=l.getContext("2d");if(j==true){l.width=$(window).width();l.height=$(window).height()}if(b){l.width=l.parentNode.offsetWidth}var d=l.width;var a=l.height;var m=a;if(8*d/13<=a){m=8*d/13}var h=10*m/13;var g=(m/3)>>0;var f=d/2;var e=11*m/13;return new data(m,h,g,f,e)};var drawIndicatorText=function(a,g,l,j,b,f,h,c,e,k){var n=document.getElementById(a);var m=n.getContext("2d");m.clearRect(0,0,n.width,n.height);if(k){m.shadowColor="rgba(0,0,0,0.15)";m.shadowOffsetX=3;m.shadowOffsetY=3;m.shadowBlur=2}m.fillStyle="black";m.font="bold "+e.size/10+"px Arial";m.fillText(g,e.x-m.measureText(g).width/2,e.y-e.radix+e.arcWidth/2+e.size/10);m.fillStyle="gray";if(c==true){m.font=e.size/10+"px Arial";if(j!=""){b=b+j;f=f+j}m.fillText(b,e.x-e.radix+e.arcWidth/2-m.measureText(b).width/2,e.y+e.size/10);m.fillText(f,e.x+e.radix-e.arcWidth/2-m.measureText(f).width/2,e.y+e.size/10)}if(l!=""){m.font=e.size/12+"px Arial";m.fillText(l,e.x-m.measureText(l).width/2,e.y+e.size/12)}if(j!=""){h=h+j}m.fillStyle="black";m.font="bold "+e.size/6+"px Arial";m.fillText(h,e.x-m.measureText(h).width/2,e.y);m.shadowBlur=0;m.shadowOffsetX=0;m.shadowOffsetY=0};var drawIndicatorColor=function(a,b,c,g,f,h){var k=document.getElementById(a);var j=k.getContext("2d");j.beginPath();j.arc(f.x,f.y-1,f.radix-2,Math.PI,0,false);j.arc(f.x,f.y-1,f.radix+2-f.arcWidth,0,Math.PI,true);j.closePath();j.fillStyle="white";j.fill();j.beginPath();j.arc(f.x,f.y-1,f.radix-1.5,Math.PI,b-Math.PI,false);j.arc(f.x,f.y-1,f.radix-f.arcWidth-0.5,b-Math.PI,Math.PI,true);j.closePath();var e=j.createLinearGradient(f.x-f.radix,f.y,f.x,f.y);e.addColorStop(0,"white");e.addColorStop(1,c);j.fillStyle=e;j.fill();if(h){j.shadowColor="rgba(0,0,0,0.15)";j.shadowOffsetX=3;j.shadowOffsetY=3;j.shadowBlur=2}j.fillStyle="black";j.font="bold "+f.size/10+"px Arial";j.fillText(g,f.x-j.measureText(g).width/2,f.y-f.radix+f.arcWidth/2+f.size/10);j.shadowBlur=0;j.shadowOffsetX=0;j.shadowOffsetY=0};var drawIndicatorArc=function(e,c){var b=document.getElementById(e);var a=b.getContext("2d");a.strokeStyle="gray";a.beginPath();a.arc(c.x,c.y,c.radix,Math.PI,0,false);a.arc(c.x,c.y,c.radix-c.arcWidth-0.5,0,Math.PI,true);a.lineTo(c.x-c.radix,c.y);a.closePath();a.stroke()};function indicatorP(c,d,j,n,l,e,h,k,f,m,o,a){var p=document.getElementById(c);if(p==null){return}if(a){window.addEventListener("resize",b,false)}g(true);function g(r){var t=getData(c,o,a);drawIndicatorText(c,j,n,l,e,h,k,f,t,m);if(k>h){k=h}var q=Math.abs(h-e);var w=Math.abs(e-k);var s=(q-w)/q;var v=1;var u=180*(1-s);if(k>e){if(r){$({n:v}).animate({n:u},{duration:1000,step:function(y,z){drawIndicatorColor(c,y*Math.PI/180,d,j,t,m)}})}else{drawIndicatorColor(c,u*Math.PI/180,d,j,t,m)}}drawIndicatorArc(c,t)}function b(){var q=document.getElementById(c);if(q!=null){g(false)}}}function indicator(b,l,n,a){var g=l.title;if(typeof g==="undefined"){g=""}var m=l.description;if(typeof m==="undefined"){m=""}var j=l.unit;if(typeof j==="undefined"){j=""}var h=l.value;if(typeof h==="undefined"){h=0}var d=l.min;if(typeof d==="undefined"){d=0}var f=l.max;if(typeof f==="undefined"){f=100}var e=l.showMinMax;if(typeof e==="undefined"){e=true}var c=l.color;if(typeof c==="undefined"){c="blue"}var k=l.shadow;if(typeof k==="undefined"){k=false}indicatorP(b,c,g,m,j,d,f,h,e,k,n,a)}function getIndicatorHeight(){return $(window).height()}function display(f,e,c,a){if(a){window.addEventListener("resize",d,false)}b(true);function b(l){var o=document.getElementById(f);if(o==null){return}var v=o.getContext("2d");if(c==true){o.width=$(window).width();o.height=$(window).height()}if(a){o.width=o.parentNode.offsetWidth}var h=o.width;var p=o.height;if(p>h){p=h}var k=p/5;var q=p/10;var A=e.background;if(typeof A==="undefined"){A="white"}var m=e.shadow;if(typeof m==="undefined"){m=false}var t=e.value;if(typeof t==="undefined"){t="NA"}var s=e.valueColor;if(typeof s==="undefined"){s="black"}var B=e.title;var y=e.titleColor;if(typeof y==="undefined"){y="black"}var z=e.titleAlignment;if(typeof z==="undefined"){z="alignToValue"}var j=e.previous;v.clearRect(0,0,o.width,o.height);v.fillStyle=A;v.fillRect(0,0,o.width,o.height);if(m){v.shadowColor="rgba(0,0,0,0.15)";v.shadowOffsetX=3;v.shadowOffsetY=3;v.shadowBlur=2}v.fillStyle=s;v.font="bold "+k+"px Arial";var w=h/2-v.measureText(t).width/2;v.fillText(t,w,p/2+k/4);if(typeof B!=="undefined"){v.fillStyle=y;v.font="bold "+q+"px Arial";var g=w;if(z==="center"){g=h/2-v.measureText(B).width/2}v.fillText(B,g,2*q)}if(typeof j!=="undefined"){var r=e.previousColor;if(typeof r==="undefined"){r="gray"}var n=e.up;if(typeof n==="undefined"){n=true}var u=e.shouldRise;if(typeof u==="undefined"){u=true}drawDisplayArrow(v,w+k/4,p-2*q,n,k,u);v.fillStyle=r;v.font="bold "+k/2+"px Arial";v.fillText(j,w+k/1.5,p-2*q+k/16)}}function d(){var g=document.getElementById(f);if(g!=null){b(false)}}}function drawDisplayArrow(k,h,f,a,g,e){var j=g/1.5;k.beginPath();if(a){k.moveTo(h-j/2,f+Math.sqrt(3)*j/6);k.lineTo(h,f-2*Math.sqrt(3)*j/6);k.lineTo(h+j/2,f+Math.sqrt(3)*j/6);k.lineTo(h-j/2,f+Math.sqrt(3)*j/6)}else{k.moveTo(h-j/2,f-2*Math.sqrt(3)*j/6);k.lineTo(h+j/2,f-2*Math.sqrt(3)*j/6);k.lineTo(h,f+Math.sqrt(3)*j/6);k.lineTo(h-j/2,f-2*Math.sqrt(3)*j/6)}k.closePath();var b="red";if((e&&a)||(!e&&!a)){b="green"}k.fillStyle=b;k.fill();k.strokeStyle="gray";k.stroke()}function alarm(g,e,d,a){if(a){window.addEventListener("resize",b,false)}f(true);function f(t){var B=document.getElementById(g);if(B==null){return}var L=B.getContext("2d");if(d==true){B.width=$(window).width();B.height=$(window).height()}if(a){B.width=B.parentNode.offsetWidth}var m=B.width;var E=B.height;var H=E/10;var F=e.text;if(typeof F==="undefined"){F=""}var O=e.color;if(typeof O==="undefined"){O="green"}var P=e.background;if(typeof P==="undefined"){P="white"}var v=e.shadow;if(typeof v==="undefined"){v=false}if(v){L.shadowColor="rgba(0,0,0,0.15)";L.shadowOffsetX=3;L.shadowOffsetY=3;L.shadowBlur=2}var I=m;if(E<m){I=E}var s=m/20;var C=Math.pow(I,1.1)/8;var R=2;var q=(I-2*C)/2;var p=Math.log(I/20)*9;L.clearRect(0,0,B.width,B.height);L.fillStyle=P;L.fillRect(0,0,B.width,B.height);L.fillStyle="black";L.font=p+"px Arial";var Q=3*s/2+2*q;var A=E/2+p/4;var o=L.measureText(F).width+s;var h=new Array();if(Q+o>m){var T=F.split(" ");var J=T.length;var D="";for(var N=0;N<J;N++){var z=D+T[N]+" ";var l=L.measureText(z).width+s;if(Q+l>m){h.push(D);D=T[N]+" "}else{D=z}}h.push(D);var j=h.length;var u=((j%2)!=0);var S=Math.floor(j/2);if(u){for(var D=0;D<S;D++){var w=A-(S-D)*p;L.fillText(h[D],Q,w)}L.fillText(h[S],Q,A);for(var D=S+1;D<j;D++){var w=A+(D-S)*p;L.fillText(h[D],Q,w)}}else{for(var D=0;D<S;D++){var w=A-p/2-(S-D-1)*p;L.fillText(h[D],Q,w)}for(var D=S;D<j;D++){var w=A+p/2+(D-S)*p;L.fillText(h[D],Q,w)}}}else{L.fillText(F,Q,A)}L.shadowBlur=0;L.shadowOffsetX=0;L.shadowOffsetY=0;var C=s+q;var w=E/2;var G=q;var M=1;var n=G-2*R;var K=L.createLinearGradient(s,E/2-q/2*Math.sin(3*Math.PI/8),s+2*q,E/2+q*Math.sin(3*Math.PI/8));K.addColorStop(0,"white");K.addColorStop(1,O);if(t){$({n:M}).animate({n:n},{duration:1000,step:function(k,r){c(g,C,w,k,R,K)},complete:function(){}})}else{c(g,C,w,n,R,K)}}function c(p,h,o,m,n,k){var l=document.getElementById(p);var j=l.getContext("2d");j.beginPath();j.arc(h,o,m+2,2*Math.PI,0,false);j.closePath();j.fillStyle="white";j.fill();j.strokeStyle="gray";j.beginPath();j.arc(h,o,m,2*Math.PI,0,false);j.closePath();j.stroke();if(m>2*n){j.beginPath();j.arc(h,o,m-2*n,2*Math.PI,0,false);j.closePath();j.stroke();j.fillStyle=k;j.fill()}}function b(){var h=document.getElementById(g);if(h!=null){f(false)}}}function nextWidget(b,d,e,c,a){if(b=="indicator"){indicator(e,d,c,a)}else{if(b=="display"){display(e,d,c,a)}else{if(b=="alarm"){alarm(e,d,c,a)}}}}var capturePdf=function(b){var a;if(b.position===undefined){a=b.elements[0]}else{a=b.elements[b.position-1]}if((b.position===undefined)||(b.position==1)){if(b.title!==undefined){c(b.doc,b.title,10)}}html2canvas($(a),{onrendered:function(e){var d=e.toDataURL("image/png");var h=($(a).width()*25.4)/96;var f=($(a).height()*25.4)/96;var g=0,j=0;if(f>b.doc.internal.pageSize.height){if(h>b.doc.internal.pageSize.width){if(f-b.doc.internal.pageSize.height>h-b.doc.internal.pageSize.width){g=h*(b.doc.internal.pageSize.height-20)/f;j=b.doc.internal.pageSize.height-20}else{g=b.doc.internal.pageSize.width-20;j=f*(b.doc.internal.pageSize.width-20)/h}}else{g=h*(b.doc.internal.pageSize.height-20)/f;j=b.doc.internal.pageSize.height-20}}else{if(h>b.doc.internal.pageSize.width){g=b.doc.internal.pageSize.width-20;j=f*(b.doc.internal.pageSize.width-20)/h}}if(g>0){var l=(b.doc.internal.pageSize.height-j)/2;if(l<10){l=10}b.doc.addImage(d,"PNG",10,l,g,j)}else{var m=(b.doc.internal.pageSize.width-h)/2;var l=(b.doc.internal.pageSize.height-f)/2;b.doc.addImage(d,"PNG",m,l)}var k=1;var o=b.elements.length;if(b.position!==undefined){k=b.position}if(b.showFooter){var n="Page "+k+" / "+o;if(b.footerText!==undefined){n=b.footerText}c(b.doc,n,b.doc.internal.pageSize.height-5,150,10)}if((b.position!==undefined)&&(b.position<o)){b.doc.addPage();b.position=b.position+1;capturePdf(b)}else{b.doc.setProperties({title:"Dashboard",subject:"NextReports Dashboard",author:"NextCharts",keywords:"nextreports, dashboard, pdf",creator:"Mihai Dinca-Panaitescu"});b.doc.save("dashboard.pdf")}}});function c(g,j,k,d,f){if(d!==undefined){g.setTextColor(d)}if(f!==undefined){g.setFontSize(f)}var h=g.getStringUnitWidth(j)*g.internal.getFontSize()/g.internal.scaleFactor;var e=(g.internal.pageSize.width-h)/2;g.text(e,k,j)}};